<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ITS_LIVE_TOOL - 05: Data inspection – slow-moving glaciers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="ITS_LIVE_TOOL - 05: Data inspection – slow-moving glaciers">
<meta property="og:description" content="">
<meta property="og:site-name" content="ITS_LIVE_TOOL">
<meta name="twitter:title" content="ITS_LIVE_TOOL - 05: Data inspection – slow-moving glaciers">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ITS_LIVE_TOOL</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data_inspection.html">05: Data inspection – slow-moving glaciers</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ITS_LIVE_TOOL</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datacube_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">datacube_tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02: interactive_data_selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./obj_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04: access_setup – Data setup + prep</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_inspection.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">05: Data inspection – slow-moving glaciers</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-inspection" id="toc-data-inspection" class="nav-link active" data-scroll-target="#data-inspection">Data Inspection</a>
  <ul class="collapse">
  <li><a href="#data-prep" id="toc-data-prep" class="nav-link" data-scroll-target="#data-prep">Data prep</a></li>
  <li><a href="#thresholding-using-v_error" id="toc-thresholding-using-v_error" class="nav-link" data-scroll-target="#thresholding-using-v_error">1. Thresholding using v_error</a>
  <ul class="collapse">
  <li><a href="#description" id="toc-description" class="nav-link" data-scroll-target="#description">Description</a></li>
  <li><a href="#pros" id="toc-pros" class="nav-link" data-scroll-target="#pros">Pros</a></li>
  <li><a href="#cons" id="toc-cons" class="nav-link" data-scroll-target="#cons">Cons</a></li>
  <li><a href="#visualize-results" id="toc-visualize-results" class="nav-link" data-scroll-target="#visualize-results">Visualize results</a></li>
  </ul></li>
  <li><a href="#thresholding-via-min-temp-baseline-threshold" id="toc-thresholding-via-min-temp-baseline-threshold" class="nav-link" data-scroll-target="#thresholding-via-min-temp-baseline-threshold">2. Thresholding via min temp baseline threshold</a>
  <ul class="collapse">
  <li><a href="#description-1" id="toc-description-1" class="nav-link" data-scroll-target="#description-1">Description:</a></li>
  <li><a href="#pros-1" id="toc-pros-1" class="nav-link" data-scroll-target="#pros-1">Pros</a></li>
  <li><a href="#find-long-term-speed-at-this-point" id="toc-find-long-term-speed-at-this-point" class="nav-link" data-scroll-target="#find-long-term-speed-at-this-point">Find long-term speed at this point</a></li>
  </ul></li>
  <li><a href="#blunt-temporal-baseline-minimum-for-all-sensors" id="toc-blunt-temporal-baseline-minimum-for-all-sensors" class="nav-link" data-scroll-target="#blunt-temporal-baseline-minimum-for-all-sensors">3. Blunt temporal baseline minimum for all sensors</a>
  <ul class="collapse">
  <li><a href="#pros-2" id="toc-pros-2" class="nav-link" data-scroll-target="#pros-2">Pros</a></li>
  <li><a href="#cons-1" id="toc-cons-1" class="nav-link" data-scroll-target="#cons-1">Cons</a></li>
  </ul></li>
  <li><a href="#comparison-to-faster-flowing-glacier" id="toc-comparison-to-faster-flowing-glacier" class="nav-link" data-scroll-target="#comparison-to-faster-flowing-glacier">Comparison to faster-flowing glacier</a></li>
  <li><a href="#anomaly-detection-attempts" id="toc-anomaly-detection-attempts" class="nav-link" data-scroll-target="#anomaly-detection-attempts">anomaly detection attempts</a>
  <ul class="collapse">
  <li><a href="#fit-spline-to-points-then-take-1st-2nd-derivative-of-interpolated-spline" id="toc-fit-spline-to-points-then-take-1st-2nd-derivative-of-interpolated-spline" class="nav-link" data-scroll-target="#fit-spline-to-points-then-take-1st-2nd-derivative-of-interpolated-spline">1. fit spline to points, then take 1st, 2nd derivative of interpolated spline</a></li>
  <li><a href="#log-transforming-y-data-then-fitting-spline" id="toc-log-transforming-y-data-then-fitting-spline" class="nav-link" data-scroll-target="#log-transforming-y-data-then-fitting-spline">Log transforming y data then fitting spline</a></li>
  </ul></li>
  <li><a href="#variogram" id="toc-variogram" class="nav-link" data-scroll-target="#variogram">variogram ?</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/e-marshall/ITS_LIVE_TOOL/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">05: Data inspection – slow-moving glaciers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="data-inspection" class="level1">
<h1>Data Inspection</h1>
<p>This is a notebook intended to highlight some of the questions that can arise, specifically when using ITS_LIVE to study slower moving glaciers. The notebook contains a few functions designed to filter the dataset based on different characteristics. They are designed to be modular and flexible. NOTE: these are not meant to be blindly implemented, rather to provide examples of possible solutions to outlier detection problems. Feel free to use and adjust them to best fit your use-case.</p>
<section id="data-prep" class="level2">
<h2 class="anchored" data-anchor-id="data-prep">Data prep</h2>
</section>
<section id="thresholding-using-v_error" class="level2">
<h2 class="anchored" data-anchor-id="thresholding-using-v_error">1. Thresholding using v_error</h2>
<section id="description" class="level3">
<h3 class="anchored" data-anchor-id="description">Description</h3>
<p>ITS_LIVE image pair data comes with an associated velocity error variable. It is calculated by : (insert equation from docs).</p>
<p>One way you may want to threshold your dataset is to use the <code>v_error</code> variable. This notebook provides an example of setting an acceptable threshold of <code>v_error</code> in relation to <code>v</code>, and excluding any observations where <code>v_error</code> exceeds this limit.</p>
</section>
<section id="pros" class="level3">
<h3 class="anchored" data-anchor-id="pros">Pros</h3>
</section>
<section id="cons" class="level3">
<h3 class="anchored" data-anchor-id="cons">Cons</h3>
<pre class="{note}"><code>there is an issue w/ this fn, figure it out wednesday</code></pre>
</section>
<section id="visualize-results" class="level3">
<h3 class="anchored" data-anchor-id="visualize-results">Visualize results</h3>
<section id="visualizing-just-the-excluded-datasets" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-just-the-excluded-datasets">Visualizing just the excluded datasets</h4>
</section>
</section>
</section>
<section id="thresholding-via-min-temp-baseline-threshold" class="level2">
<h2 class="anchored" data-anchor-id="thresholding-via-min-temp-baseline-threshold">2. Thresholding via min temp baseline threshold</h2>
<section id="description-1" class="level3">
<h3 class="anchored" data-anchor-id="description-1">Description:</h3>
<p>-add a citation for nyquist principle This method considers the expected ice movement of the selected point on the glacier based on long-term movement at this location and compares this value to the ground sampling distance of the imaging sensor to determine the minimum temporal baseline that would be needed to capture expected ice movement. To accomplish this, we take only the observations measured from image pairs where the temporal baseline is greater than 365 days. We then calculate the median velocity of all of these observations and use this as the expected displacement value. To calculate the minimum temporal baseline, we consider the expected displacement and the Nyquist Principle which states that sampling frequency must be at least twice the expected frequency of the data variability (rewrite) to avoid artifacts related to aliasing and other sampling distortions. The resulting dataset has a calculated minimum temporal baseline for each imaging sensor that contributes to the dataset. Due to the approximate nature of this approach and in order to minimize erroneously excluded observations we do not include a term related to the performance of the chip correlation algorithm, though this is another source of error that would increase the minimum temporal baseline over which ice displacement could be confidently detected.</p>
</section>
<section id="pros-1" class="level3">
<h3 class="anchored" data-anchor-id="pros-1">Pros</h3>
<ul>
<li>physical basis. This approach is rooted in limitations of the satellite imaging sensors used and the long-term record of long temporal baseline velocity estimates which are typically characterized by less noise and higher confidence than shorter temporal baseline pairs. ### Cons</li>
<li>potentially very overly-conservative. We are basing the expected ice movement on a long-term median velocity value. If shorter-term velocity velocity variability is significantly faster than this long-term, expected value than these observations may be incorrectly excluded.</li>
<li>Needs to be applied carefully if your analysis will include a spatial dimension. Put differently, this method in its current form would be inappropriate if it is separately calculated for each point included in analysis because it would create the situation where ice velocity estimates derived from different length image pairs are being compared.</li>
</ul>
</section>
<section id="find-long-term-speed-at-this-point" class="level3">
<h3 class="anchored" data-anchor-id="find-long-term-speed-at-this-point">Find long-term speed at this point</h3>
</section>
</section>
<section id="blunt-temporal-baseline-minimum-for-all-sensors" class="level2">
<h2 class="anchored" data-anchor-id="blunt-temporal-baseline-minimum-for-all-sensors">3. Blunt temporal baseline minimum for all sensors</h2>
<section id="pros-2" class="level3">
<h3 class="anchored" data-anchor-id="pros-2">Pros</h3>
<ul>
<li>Much simpler to apply at scale, across multiple points and glaciers</li>
</ul>
</section>
<section id="cons-1" class="level3">
<h3 class="anchored" data-anchor-id="cons-1">Cons</h3>
<ul>
<li>Least sensitive to the structure of the dataset</li>
<li>No explicit physical basis, this method is only as effective as the choice of threshold</li>
</ul>
</section>
</section>
<section id="comparison-to-faster-flowing-glacier" class="level2">
<h2 class="anchored" data-anchor-id="comparison-to-faster-flowing-glacier">Comparison to faster-flowing glacier</h2>
<p>Recreating the above-plots for a point on a faster-moving glacier, we see a few interesting things.</p>
<p><a href="https://github.com/vdevauxchupin/ITS_LIVE_TOOL/blob/main/figs/Figure%2013.png?raw=true">Malaspina glacier, Alaska</a></p>
</section>
<section id="anomaly-detection-attempts" class="level2">
<h2 class="anchored" data-anchor-id="anomaly-detection-attempts">anomaly detection attempts</h2>
<section id="fit-spline-to-points-then-take-1st-2nd-derivative-of-interpolated-spline" class="level3">
<h3 class="anchored" data-anchor-id="fit-spline-to-points-then-take-1st-2nd-derivative-of-interpolated-spline">1. fit spline to points, then take 1st, 2nd derivative of interpolated spline</h3>
<section id="univariate-spline" class="level4">
<h4 class="anchored" data-anchor-id="univariate-spline">univariate spline</h4>
</section>
</section>
<section id="log-transforming-y-data-then-fitting-spline" class="level3">
<h3 class="anchored" data-anchor-id="log-transforming-y-data-then-fitting-spline">Log transforming y data then fitting spline</h3>
</section>
</section>
<section id="variogram" class="level2">
<h2 class="anchored" data-anchor-id="variogram">variogram ?</h2>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
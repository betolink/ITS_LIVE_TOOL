<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="package for working with itslive ice velocity data">

<title>ITS_LIVE_TOOL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="ITS_LIVE_TOOL">
<meta property="og:description" content="package for working with itslive ice velocity data">
<meta property="og:image" content="https://github.com/e-marshall/ITS_LIVE_TOOL/blob/main/figs/baltoro_raw_data_example.png?raw=true">
<meta property="og:site-name" content="ITS_LIVE_TOOL">
<meta name="twitter:title" content="ITS_LIVE_TOOL">
<meta name="twitter:description" content="package for working with itslive ice velocity data">
<meta name="twitter:image" content="https://github.com/e-marshall/ITS_LIVE_TOOL/blob/main/figs/baltoro_raw_data_example.png?raw=true">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ITS_LIVE_TOOL</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html">ITS_LIVE_TOOL</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ITS_LIVE_TOOL</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datacube_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">datacube_tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02: interactive_data_selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./obj_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04: access_setup – Data setup + prep</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_inspection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05: Data inspection – slow-moving glaciers</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about" id="toc-about" class="nav-link active" data-scroll-target="#about">About</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#data-access-organization" id="toc-data-access-organization" class="nav-link" data-scroll-target="#data-access-organization">Data Access + Organization</a></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing">Data Processing</a></li>
  <li><a href="#processing" id="toc-processing" class="nav-link" data-scroll-target="#processing">Processing</a></li>
  </ul></li>
  <li><a href="#install" id="toc-install" class="nav-link" data-scroll-target="#install">Install</a></li>
  </ul></li>
  <li><a href="#section-1-data-access-organization" id="toc-section-1-data-access-organization" class="nav-link" data-scroll-target="#section-1-data-access-organization">Section 1: Data Access + Organization</a>
  <ul class="collapse">
  <li><a href="#how-to-use" id="toc-how-to-use" class="nav-link" data-scroll-target="#how-to-use">How to use</a></li>
  <li><a href="#interactive-data-selection-widget" id="toc-interactive-data-selection-widget" class="nav-link" data-scroll-target="#interactive-data-selection-widget">Interactive data selection widget</a></li>
  <li><a href="#create-data-objects" id="toc-create-data-objects" class="nav-link" data-scroll-target="#create-data-objects">Create data objects</a></li>
  <li><a href="#manually-create-glacier-glacier_point-glacier_centerline-objects" id="toc-manually-create-glacier-glacier_point-glacier_centerline-objects" class="nav-link" data-scroll-target="#manually-create-glacier-glacier_point-glacier_centerline-objects">Manually create <code>Glacier</code>, <code>Glacier_Point</code>, <code>Glacier_Centerline</code> objects</a></li>
  <li><a href="#glacier_point" id="toc-glacier_point" class="nav-link" data-scroll-target="#glacier_point"><code>Glacier_Point</code></a></li>
  <li><a href="#glacier_centerline" id="toc-glacier_centerline" class="nav-link" data-scroll-target="#glacier_centerline"><code>Glacier_Centerline</code></a></li>
  </ul></li>
  <li><a href="#section-2-data-processing" id="toc-section-2-data-processing" class="nav-link" data-scroll-target="#section-2-data-processing">Section 2: Data Processing</a>
  <ul class="collapse">
  <li><a href="#gaussian-process-regression-1" id="toc-gaussian-process-regression-1" class="nav-link" data-scroll-target="#gaussian-process-regression-1">Gaussian Process Regression</a>
  <ul class="collapse">
  <li><a href="#problem" id="toc-problem" class="nav-link" data-scroll-target="#problem">Problem:</a></li>
  <li><a href="#raw-data" id="toc-raw-data" class="nav-link" data-scroll-target="#raw-data">Raw data</a></li>
  <li><a href="#gaussian-process-model-predictions" id="toc-gaussian-process-model-predictions" class="nav-link" data-scroll-target="#gaussian-process-model-predictions">Gaussian Process model predictions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#datacube-inversion" id="toc-datacube-inversion" class="nav-link" data-scroll-target="#datacube-inversion">Datacube Inversion</a></li>
  <li><a href="#theory-of-velocity-interpolation-for-a-single-point-time-series" id="toc-theory-of-velocity-interpolation-for-a-single-point-time-series" class="nav-link" data-scroll-target="#theory-of-velocity-interpolation-for-a-single-point-time-series">Theory of velocity interpolation for a single point time series</a></li>
  <li><a href="#inversion-applied-to-its_live" id="toc-inversion-applied-to-its_live" class="nav-link" data-scroll-target="#inversion-applied-to-its_live">Inversion applied to ITS_LIVE</a></li>
  <li><a href="#input-your-parameters-below" id="toc-input-your-parameters-below" class="nav-link" data-scroll-target="#input-your-parameters-below">Input your parameters below</a>
  <ul class="collapse">
  <li><a href="#select-your-data" id="toc-select-your-data" class="nav-link" data-scroll-target="#select-your-data">Select your data</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/e-marshall/ITS_LIVE_TOOL/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ITS_LIVE_TOOL</h1>
</div>

<div>
  <div class="description">
    package for working with itslive ice velocity data
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="about" class="level1">
<h1>About</h1>
<p><code>ITS_LIVE_TOOL</code> is a package designed to aid users working with the <a href="link">Inter-mission Time Series of Land Ice Velocity and Elevation</a> (ITS_LIVE) dataset. The package provides functions for accessing data as well as various methods to process ITS_LIVE observations. This notebook will demonstrate various elements of the package and walk through the steps of a typical workflow using ITS_LIVE_TOOL.</p>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<pre class="{note}"><code>keep this overview here? or move to readme doc?</code></pre>
<p>The tools in the package fall into two main categories: 1) data access + organization, 2) data processing.</p>
<section id="data-access-organization" class="level3">
<h3 class="anchored" data-anchor-id="data-access-organization">Data Access + Organization</h3>
<section id="interactive-map-widget" class="level4">
<h4 class="anchored" data-anchor-id="interactive-map-widget">1. Interactive map widget</h4>
<p>This is an interactive widget design to streamline access ITS_LIVE image pair ice velocity time series.</p>
</section>
<section id="glacier-glacier_centerline-glacier_point-objects" class="level4">
<h4 class="anchored" data-anchor-id="glacier-glacier_centerline-glacier_point-objects">2. <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier"><code>Glacier</code></a>, <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_centerline"><code>Glacier_Centerline</code></a>, <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_point"><code>Glacier_Point</code></a> objects</h4>
<p>These are provided to store and keep track of different types of data related to individual units of analysis such as points, centerlines or full glacier surface areas.</p>
<p>This roadmap document will first demonstrate data access and organization tools before demonstrating the processing tools.</p>
</section>
</section>
<section id="data-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-processing">Data Processing</h3>
<p>We demonstrate and make available two processing routines. Be sure to check out the accompanying <a href="">book</a> and consider if either of these are appropriate for your data and use case. Note that these methods are in active development and thus should be considered in <em>beta</em> phase. Please perform your own data inspection and due diligence if implementing these methods.</p>
<section id="inversion" class="level4">
<h4 class="anchored" data-anchor-id="inversion">Inversion</h4>
<p><strong>to add</strong> Description – link to full description and examples</p>
</section>
<section id="gaussian-process-regression" class="level4">
<h4 class="anchored" data-anchor-id="gaussian-process-regression">Gaussian Process Regression</h4>
<p><strong>to add</strong> Description – link to full description and examples</p>
</section>
</section>
<section id="processing" class="level3">
<h3 class="anchored" data-anchor-id="processing">Processing</h3>
<p>We demonstrate and make available two processing routines. Be sure to check out the accompanying <a href="">book</a> and consider if either of these are appropriate for your data and use case. Note that these methods are in active development and thus should be considered in <em>beta</em> phase. Please perform your own data inspection and due diligence if implementing these methods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ITS_LIVE_TOOL <span class="im">import</span> datacube_tools, interactive, obj_setup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyproj</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.path <span class="im">as</span> path</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zarr</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> timedelta</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.path <span class="im">as</span> mplp</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ipyleaflet <span class="im">as</span> ipyl</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipyleaflet <span class="im">import</span> WMSLayer</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ipywidgets <span class="im">as</span> ipyw</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipyleaflet <span class="im">import</span> Map, WMSLayer, basemaps</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> HTML</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> owslib.wms <span class="im">import</span> WebMapService</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="install" class="level2">
<h2 class="anchored" data-anchor-id="install">Install</h2>
<p>Install this package using the below command</p>
<pre class="{note}"><code>someday we hope to have a pip or conda install, for now use pip install git+ github repo url</code></pre>
</section>
</section>
<section id="section-1-data-access-organization" class="level1">
<h1>Section 1: Data Access + Organization</h1>
<section id="how-to-use" class="level3">
<h3 class="anchored" data-anchor-id="how-to-use">How to use</h3>
<p>There are two ways to access data using ITS_LIVE_TOOL. The first way is through the interactive widget. This is great for exploratory analysis. The second way is by specifying an RGI ID and point coordinates manually. This is useful if you already know which glacier(s) you want to examine and simply want to pass a list of RGI IDs and coordinates. We’ll first demonstrate using the interactive widget.</p>
</section>
<section id="interactive-data-selection-widget" class="level3">
<h3 class="anchored" data-anchor-id="interactive-data-selection-widget">Interactive data selection widget</h3>
<p>First, use the interactive map to select data. Do this by right- and left-clicking on the map location where you’d like to access data. This will return an object containing the coordinates of the point you clicked, a <code>geopandas.GeoDataFrame</code> of the <a href="http://www.glims.org/rgi_user_guide/welcome.html">RGI7</a> data for that glacier and the URL of the ITS_LIVE granule covering the clicked point.</p>
<pre class="{note}"><code>If the glacier you want to study lies in multiple ITS_LIVE granules, or you'd like to look at multiple glaciers, click in multiple points and the output objects will be appended with each click. </code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data_map <span class="op">=</span> interactive.Widget()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data_map.display()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e1054c0ad7cf46dd9403b265c55f6778","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section>
<section id="create-data-objects" class="level3">
<h3 class="anchored" data-anchor-id="create-data-objects">Create data objects</h3>
<p>Once you have made your selection(s) on the map, use the following methods to create objects that will store your data</p>
<section id="if-youve-only-selected-one-glacier-create-individual-objects-as-follows" class="level4">
<h4 class="anchored" data-anchor-id="if-youve-only-selected-one-glacier-create-individual-objects-as-follows">If you’ve only selected one glacier, create individual objects as follows:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data_map.urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['http://its-live-data.s3.amazonaws.com/datacubes/v2/N50W140/ITS_LIVE_vel_EPSG3413_G0120_X-3350000_Y350000.zarr',
 'http://its-live-data.s3.amazonaws.com/datacubes/v2/N60W140/ITS_LIVE_vel_EPSG3413_G0120_X-3250000_Y350000.zarr',
 'http://its-live-data.s3.amazonaws.com/datacubes/v2/N50W130/ITS_LIVE_vel_EPSG3413_G0120_X-3350000_Y250000.zarr',
 'http://its-live-data.s3.amazonaws.com/datacubes/v2/N60W130/ITS_LIVE_vel_EPSG3413_G0120_X-3250000_Y250000.zarr']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>glacier <span class="op">=</span> obj_setup.create_glacier_from_click(data_map, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>glacier.itslive_url</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'http://its-live-data.s3.amazonaws.com/datacubes/v2/N50W140/ITS_LIVE_vel_EPSG3413_G0120_X-3350000_Y350000.zarr'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>glacier_point <span class="op">=</span> obj_setup.create_glacier_point_from_click(data_map, <span class="dv">0</span>, <span class="st">'phony label'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>original xy [-143.04795214410368, 60.37791914446092] 4326 maps to datacube (-3247134.1548154885, 459126.5490621218) EPSG:3413
original xy [-143.04795214410368, 60.37791914446092] 4326 maps to datacube (-3247134.1548154885, 459126.5490621218) EPSG:3413
subset and load at  63.19 seconds</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
KeyboardInterrupt
</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>glacier_centerline <span class="op">=</span> obj_setup.create_glacier_centerline_from_click(data_map, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see, these objects all store data related to the same glacier that was selected, but at different spatial scales. The <code>glacier</code> object contains an RGIID, name and the RGI outline and attributes for that glacier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>glacier.outline_prj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">CENLON</th>
<th data-quarto-table-cell-role="th">ZMAX</th>
<th data-quarto-table-cell-role="th">BGNDATE</th>
<th data-quarto-table-cell-role="th">ZMIN</th>
<th data-quarto-table-cell-role="th">RGIID</th>
<th data-quarto-table-cell-role="th">ASPECT</th>
<th data-quarto-table-cell-role="th">CENLAT</th>
<th data-quarto-table-cell-role="th">SLOPE</th>
<th data-quarto-table-cell-role="th">ZMED</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">TERMTYPE</th>
<th data-quarto-table-cell-role="th">O2REGION</th>
<th data-quarto-table-cell-role="th">STATUS</th>
<th data-quarto-table-cell-role="th">ENDDATE</th>
<th data-quarto-table-cell-role="th">FORM</th>
<th data-quarto-table-cell-role="th">SURGING</th>
<th data-quarto-table-cell-role="th">GLIMSID</th>
<th data-quarto-table-cell-role="th">O1REGION</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>RGI_Alaska.13631</td>
<td>-142.072</td>
<td>5381</td>
<td>20100910</td>
<td>3</td>
<td>RGI60-01.13635</td>
<td>273</td>
<td>60.461</td>
<td>9</td>
<td>1525</td>
<td>...</td>
<td>2</td>
<td>5</td>
<td>0</td>
<td>-9999999</td>
<td>0</td>
<td>9</td>
<td>G217928E60461N</td>
<td>1</td>
<td>Bering Glacier</td>
<td>MULTIPOLYGON (((506808.975 6723108.546, 506874...</td>
</tr>
</tbody>
</table>

<p>1 rows × 24 columns</p>
</div>
</div>
</div>
<p>The <code>glacier_point</code> object also has the RGI ID and name inherited from the map widget but additionally contains ITS_LIVE image pair velocity time series data for the selected point as well as a 3x3 pixel cube surrounding the point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>glacier_point.cube_around_point</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt;
Dimensions:                (mid_date: 21894, x: 3, y: 4)
Coordinates:
  * mid_date               (mid_date) datetime64[ns] 2020-10-27T20:55:56.2010...
  * x                      (x) float64 -3.247e+06 -3.247e+06 -3.247e+06
  * y                      (y) float64 4.593e+05 4.592e+05 4.591e+05 4.589e+05
    step_count             (mid_date) int64 0 5 12 14 ... 76928 76941 76952
    mapping                int64 0
Data variables:
    v                      (mid_date, y, x) float32 nan 182.0 nan ... 11.0 nan
    vy                     (mid_date, y, x) float32 nan -131.0 nan ... 11.0 nan
    vx                     (mid_date, y, x) float32 nan -126.0 nan ... 2.0 nan
    v_error                (mid_date, y, x) float32 nan 53.0 nan ... nan 6.0 nan
    satellite_img1         (mid_date) object '2A' '2A' '2A' '2B' ... '7' '7' '7'
    satellite_img2         (mid_date) object '2A' '2A' '2B' '2B' ... '8' '8' '8'
    acquisition_date_img1  (mid_date) datetime64[ns] 2020-10-17T20:55:01 ... ...
    acquisition_date_img2  (mid_date) datetime64[ns] 2020-11-06T20:56:51.0000...
    img_separation         (mid_date) float64 21.0 500.0 535.0 ... 217.0 312.0
Attributes: (12/19)
    Conventions:                CF-1.8
    GDAL_AREA_OR_POINT:         Area
    author:                     ITS_LIVE, a NASA MEaSUREs project (its-live.j...
    autoRIFT_parameter_file:    http://its-live-data.s3.amazonaws.com/autorif...
    datacube_software_version:  1.0
    date_created:               25-Sep-2023 22:55:04
    ...                         ...
    s3:                         s3://its-live-data/datacubes/v2/N60W140/ITS_L...
    skipped_granules:           s3://its-live-data/datacubes/v2/N60W140/ITS_L...
    time_standard_img1:         UTC
    time_standard_img2:         UTC
    title:                      ITS_LIVE datacube of image pair velocities
    url:                        https://its-live-data.s3.amazonaws.com/datacu...</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-22a30c4e-defb-44e9-8697-a43551b24855" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-22a30c4e-defb-44e9-8697-a43551b24855" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">mid_date</span>: 21894</li><li><span class="xr-has-index">x</span>: 3</li><li><span class="xr-has-index">y</span>: 4</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-7efbd927-5a07-411f-8acc-15b20d97937a" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-7efbd927-5a07-411f-8acc-15b20d97937a" class="xr-section-summary">Coordinates: <span>(5)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">mid_date</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2020-10-27T20:55:56.201017088 .....</div><input id="attrs-b2abbd34-7064-4c19-8714-2e69d3eef461" class="xr-var-attrs-in" type="checkbox"><label for="attrs-b2abbd34-7064-4c19-8714-2e69d3eef461" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-3b074b7a-6491-4cb4-9083-b4544538ad58" class="xr-var-data-in" type="checkbox"><label for="data-3b074b7a-6491-4cb4-9083-b4544538ad58" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>midpoint of image 1 and image 2 acquisition date and time with granule's centroid longitude and latitude as microseconds</dd><dt><span>standard_name :</span></dt><dd>image_pair_center_date_with_time_separation</dd></dl></div><div class="xr-var-data"><pre>array(['2020-10-27T20:55:56.201017088', '2018-07-23T21:04:06.171115008',
       '2020-11-07T09:03:10.200212992', ..., '2013-04-17T20:35:17.494323968',
       '2014-09-10T20:42:02.202106880', '2018-03-06T20:38:07.625047040'],
      dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-3.247e+06 -3.247e+06 -3.247e+06</div><input id="attrs-59e86d1c-423a-4de9-9ee3-9dc193d27254" class="xr-var-attrs-in" type="checkbox"><label for="attrs-59e86d1c-423a-4de9-9ee3-9dc193d27254" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-e0eabfa1-120e-4cc4-9c60-3814db5706af" class="xr-var-data-in" type="checkbox"><label for="data-e0eabfa1-120e-4cc4-9c60-3814db5706af" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>x coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_x_coordinate</dd><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>x coordinate of projection</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([-3247267.5, -3247147.5, -3247027.5])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">4.593e+05 4.592e+05 ... 4.589e+05</div><input id="attrs-7286437a-9772-4669-aada-7251510c6411" class="xr-var-attrs-in" type="checkbox"><label for="attrs-7286437a-9772-4669-aada-7251510c6411" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-c1e34ae9-0ba8-402a-9875-a0370a8e6b7b" class="xr-var-data-in" type="checkbox"><label for="data-c1e34ae9-0ba8-402a-9875-a0370a8e6b7b" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>y coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_y_coordinate</dd><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>y coordinate of projection</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([459307.5, 459187.5, 459067.5, 458947.5])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>step_count</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0 5 12 14 ... 76928 76941 76952</div><input id="attrs-45b77e26-44b3-4f5d-9dab-60835bbdf621" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-45b77e26-44b3-4f5d-9dab-60835bbdf621" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-07e02db1-de08-4fd0-ae98-e77f1022be78" class="xr-var-data-in" type="checkbox"><label for="data-07e02db1-de08-4fd0-ae98-e77f1022be78" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([    0,     5,    12, ..., 76928, 76941, 76952])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>mapping</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0</div><input id="attrs-daa5310c-edd7-4bad-8400-ad58635e13bc" class="xr-var-attrs-in" type="checkbox"><label for="attrs-daa5310c-edd7-4bad-8400-ad58635e13bc" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-5fd55d31-1a65-466e-8594-e5e710627a0d" class="xr-var-data-in" type="checkbox"><label for="data-5fd55d31-1a65-466e-8594-e5e710627a0d" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>crs_wkt :</span></dt><dd>PROJCS["WGS 84 / NSIDC Sea Ice Polar Stereographic North",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Polar_Stereographic"],PARAMETER["latitude_of_origin",70],PARAMETER["central_meridian",-45],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",SOUTH],AXIS["Northing",SOUTH],AUTHORITY["EPSG","3413"]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314245179</dd><dt><span>inverse_flattening :</span></dt><dd>298.257223563</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>WGS 84</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>WGS 84</dd><dt><span>horizontal_datum_name :</span></dt><dd>World Geodetic System 1984</dd><dt><span>projected_crs_name :</span></dt><dd>WGS 84 / NSIDC Sea Ice Polar Stereographic North</dd><dt><span>grid_mapping_name :</span></dt><dd>polar_stereographic</dd><dt><span>standard_parallel :</span></dt><dd>70.0</dd><dt><span>straight_vertical_longitude_from_pole :</span></dt><dd>-45.0</dd><dt><span>false_easting :</span></dt><dd>0.0</dd><dt><span>false_northing :</span></dt><dd>0.0</dd><dt><span>spatial_ref :</span></dt><dd>PROJCS["WGS 84 / NSIDC Sea Ice Polar Stereographic North",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Polar_Stereographic"],PARAMETER["latitude_of_origin",70],PARAMETER["central_meridian",-45],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",SOUTH],AXIS["Northing",SOUTH],AUTHORITY["EPSG","3413"]]</dd><dt><span>GeoTransform :</span></dt><dd>-3247327.5 120.0 0.0 459367.5 0.0 -120.0</dd></dl></div><div class="xr-var-data"><pre>array(0)</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-eb9a725e-0c83-4ad3-a3a5-a03833d8fa4c" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-eb9a725e-0c83-4ad3-a3a5-a03833d8fa4c" class="xr-section-summary">Data variables: <span>(9)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>v</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">nan 182.0 nan ... nan 11.0 nan</div><input id="attrs-8fdbda0f-e16e-4305-85a5-64c18c00e604" class="xr-var-attrs-in" type="checkbox"><label for="attrs-8fdbda0f-e16e-4305-85a5-64c18c00e604" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-7ca64435-3ce0-4176-88f4-e214abc689f0" class="xr-var-data-in" type="checkbox"><label for="data-7ca64435-3ce0-4176-88f4-e214abc689f0" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity magnitude</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[ nan, 182.,  nan],
        [171., 170., 129.],
        [151., 177., 157.],
        [ nan, 153.,  nan]],

       [[ nan,  nan,  nan],
        [ nan,  nan,  nan],
        [ nan,  nan,  nan],
        [ nan,  nan,  nan]],

       [[ nan,  nan,  nan],
        [ nan,  nan,  nan],
        [ nan,  nan,  nan],
        [ nan,  nan,  nan]],

       ...,

       [[ nan, 345.,  nan],
        [341., 354., 367.],
        [344., 363., 381.],
        [ nan, 366.,  nan]],

       [[ nan,  51.,  nan],
        [ 43.,  52.,  59.],
        [ 45.,  53.,  57.],
        [ nan,  53.,  nan]],

       [[ nan,  13.,  nan],
        [ 11.,  12.,  nan],
        [ 10.,  11.,  nan],
        [ nan,  11.,  nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>vy</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">nan -131.0 nan ... nan 11.0 nan</div><input id="attrs-b2ebaacf-af4e-444d-a7a5-8e29bc0b9093" class="xr-var-attrs-in" type="checkbox"><label for="attrs-b2ebaacf-af4e-444d-a7a5-8e29bc0b9093" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-538de3c0-7935-4b09-a4bc-bd79ea11747a" class="xr-var-data-in" type="checkbox"><label for="data-538de3c0-7935-4b09-a4bc-bd79ea11747a" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity component in y direction</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_y_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[  nan, -131.,   nan],
        [-117., -115.,  -59.],
        [-100., -118.,  -87.],
        [  nan,  -87.,   nan]],

       [[  nan,   nan,   nan],
        [  nan,   nan,   nan],
        [  nan,   nan,   nan],
        [  nan,   nan,   nan]],

       [[  nan,   nan,   nan],
        [  nan,   nan,   nan],
        [  nan,   nan,   nan],
        [  nan,   nan,   nan]],

       ...,

       [[  nan,  345.,   nan],
        [ 341.,  354.,  367.],
        [ 344.,  363.,  381.],
        [  nan,  366.,   nan]],

       [[  nan,  -42.,   nan],
        [ -33.,  -44.,  -53.],
        [ -35.,  -44.,  -50.],
        [  nan,  -44.,   nan]],

       [[  nan,   12.,   nan],
        [  10.,   11.,   nan],
        [  10.,   11.,   nan],
        [  nan,   11.,   nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>vx</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">nan -126.0 nan ... nan 2.0 nan</div><input id="attrs-fb558dc5-36c7-4935-ad7a-f6b205e54f03" class="xr-var-attrs-in" type="checkbox"><label for="attrs-fb558dc5-36c7-4935-ad7a-f6b205e54f03" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-b61d85dc-9f90-4c97-90f4-b4ff3cf6eb3e" class="xr-var-data-in" type="checkbox"><label for="data-b61d85dc-9f90-4c97-90f4-b4ff3cf6eb3e" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity component in x direction</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_x_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[  nan, -126.,   nan],
        [-124., -126., -115.],
        [-112., -132., -131.],
        [  nan, -126.,   nan]],

       [[  nan,   nan,   nan],
        [  nan,   nan,   nan],
        [  nan,   nan,   nan],
        [  nan,   nan,   nan]],

       [[  nan,   nan,   nan],
        [  nan,   nan,   nan],
        [  nan,   nan,   nan],
        [  nan,   nan,   nan]],

       ...,

       [[  nan,    7.,   nan],
        [   7.,    5.,    3.],
        [   7.,    4.,    0.],
        [  nan,    3.,   nan]],

       [[  nan,  -27.,   nan],
        [ -28.,  -28.,  -27.],
        [ -29.,  -28.,  -28.],
        [  nan,  -28.,   nan]],

       [[  nan,   -6.,   nan],
        [  -4.,   -3.,   nan],
        [  -1.,    0.,   nan],
        [  nan,    2.,   nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>v_error</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">nan 53.0 nan 54.0 ... nan 6.0 nan</div><input id="attrs-20187384-d0b7-4808-8f8a-aa0358469c00" class="xr-var-attrs-in" type="checkbox"><label for="attrs-20187384-d0b7-4808-8f8a-aa0358469c00" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-dec61493-c777-45bf-ba73-2ef23d62f5ae" class="xr-var-data-in" type="checkbox"><label for="data-dec61493-c777-45bf-ba73-2ef23d62f5ae" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity magnitude error</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>velocity_error</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[nan, 53., nan],
        [54., 54., 59.],
        [54., 55., 57.],
        [nan, 57., nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       ...,

       [[nan,  3., nan],
        [ 3.,  3.,  3.],
        [ 3.,  3.,  3.],
        [nan,  3., nan]],

       [[nan,  8., nan],
        [ 9.,  8.,  8.],
        [ 9.,  8.,  8.],
        [nan,  8., nan]],

       [[nan,  6., nan],
        [ 6.,  6., nan],
        [ 6.,  6., nan],
        [nan,  6., nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>satellite_img1</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">object</div><div class="xr-var-preview xr-preview">'2A' '2A' '2A' '2B' ... '7' '7' '7'</div><input id="attrs-9dc764eb-1d14-415f-94ac-04c43d8096cb" class="xr-var-attrs-in" type="checkbox"><label for="attrs-9dc764eb-1d14-415f-94ac-04c43d8096cb" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-45dbf68a-4e21-4cef-b63d-8742b096dc56" class="xr-var-data-in" type="checkbox"><label for="data-45dbf68a-4e21-4cef-b63d-8742b096dc56" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>id of the satellite that acquired image 1</dd><dt><span>standard_name :</span></dt><dd>image1_satellite</dd></dl></div><div class="xr-var-data"><pre>array(['2A', '2A', '2A', ..., '7', '7', '7'], dtype=object)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>satellite_img2</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">object</div><div class="xr-var-preview xr-preview">'2A' '2A' '2B' '2B' ... '8' '8' '8'</div><input id="attrs-93ad957a-0da6-4382-a01f-159928f9dcbf" class="xr-var-attrs-in" type="checkbox"><label for="attrs-93ad957a-0da6-4382-a01f-159928f9dcbf" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-be60ff78-441d-4567-b81f-dd6d7d3a6d30" class="xr-var-data-in" type="checkbox"><label for="data-be60ff78-441d-4567-b81f-dd6d7d3a6d30" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>id of the satellite that acquired image 2</dd><dt><span>standard_name :</span></dt><dd>image2_satellite</dd></dl></div><div class="xr-var-data"><pre>array(['2A', '2A', '2B', ..., '8', '8', '8'], dtype=object)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>acquisition_date_img1</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2020-10-17T20:55:01 ... 2017-10-...</div><input id="attrs-20d15c0d-5810-48e9-83b8-07ed0f364e4e" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-20d15c0d-5810-48e9-83b8-07ed0f364e4e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-e7e7bdaf-ebcf-467e-972a-c10a9e3f96d2" class="xr-var-data-in" type="checkbox"><label for="data-e7e7bdaf-ebcf-467e-972a-c10a9e3f96d2" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array(['2020-10-17T20:55:01.000000000', '2017-11-15T21:07:31.000000256',
       '2020-02-13T21:05:51.000000000', ...,
       '2012-07-31T20:32:04.164824064', '2014-05-25T20:40:40.931047936',
       '2017-10-01T20:39:43.879059968'], dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>acquisition_date_img2</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2020-11-06T20:56:51.000000256 .....</div><input id="attrs-53a58a87-2156-4be3-b140-aa7a1f9ad965" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-53a58a87-2156-4be3-b140-aa7a1f9ad965" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-1e473588-0929-413c-8c81-103fcbdee5bc" class="xr-var-data-in" type="checkbox"><label for="data-1e473588-0929-413c-8c81-103fcbdee5bc" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array(['2020-11-06T20:56:51.000000256', '2019-03-30T21:00:41.000000256',
       '2021-08-01T21:00:28.999999744', ...,
       '2014-01-02T20:38:30.582362112', '2014-12-27T20:43:23.192114944',
       '2018-08-09T20:36:31.029031936'], dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>img_separation</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">21.0 500.0 535.0 ... 217.0 312.0</div><input id="attrs-f1a4fdea-1108-4c31-8454-37bf4ae35ce5" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-f1a4fdea-1108-4c31-8454-37bf4ae35ce5" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-18c7a439-d242-4859-baad-abc242291324" class="xr-var-data-in" type="checkbox"><label for="data-18c7a439-d242-4859-baad-abc242291324" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 21., 500., 535., ..., 521., 217., 312.])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-80b54fed-faed-4bf4-9634-56de55e00b7a" class="xr-section-summary-in" type="checkbox"><label for="section-80b54fed-faed-4bf4-9634-56de55e00b7a" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>mid_date</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-794b39b2-ef34-4e87-b427-0c70ccc65267" class="xr-index-data-in" type="checkbox"><label for="index-794b39b2-ef34-4e87-b427-0c70ccc65267" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(DatetimeIndex(['2020-10-27 20:55:56.201017088',
               '2018-07-23 21:04:06.171115008',
               '2020-11-07 09:03:10.200212992',
               '2021-03-14 21:03:39.210202112',
               '2019-02-08 21:06:11.190118912',
               '2021-03-02 09:04:10.200612096',
               '2003-06-27 20:38:01.737421056',
               '2019-07-16 09:00:25.190612736',
               '2018-03-12 20:53:26.171102208',
               '2022-01-25 20:50:24.210729216',
               ...
               '2019-01-08 20:36:43.441349120',
               '2014-03-18 20:42:38.039596032',
               '2019-05-06 20:49:39.263644928',
               '2017-04-18 20:50:58.391631104',
               '2018-10-04 20:36:47.307171072',
               '2018-11-21 20:36:39.429436928',
               '2016-10-17 20:44:40.555608320',
               '2013-04-17 20:35:17.494323968',
               '2014-09-10 20:42:02.202106880',
               '2018-03-06 20:38:07.625047040'],
              dtype='datetime64[ns]', name='mid_date', length=21894, freq=None))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-d2873841-0161-4fe2-965a-cf12273717eb" class="xr-index-data-in" type="checkbox"><label for="index-d2873841-0161-4fe2-965a-cf12273717eb" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Float64Index([-3247267.5, -3247147.5, -3247027.5], dtype='float64', name='x'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-8625b719-780c-4446-909d-c8fa1c702146" class="xr-index-data-in" type="checkbox"><label for="index-8625b719-780c-4446-909d-c8fa1c702146" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Float64Index([459307.5, 459187.5, 459067.5, 458947.5], dtype='float64', name='y'))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-a7239b27-a17c-4401-a12d-9d2c5f1b5f33" class="xr-section-summary-in" type="checkbox"><label for="section-a7239b27-a17c-4401-a12d-9d2c5f1b5f33" class="xr-section-summary">Attributes: <span>(19)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>Conventions :</span></dt><dd>CF-1.8</dd><dt><span>GDAL_AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>author :</span></dt><dd>ITS_LIVE, a NASA MEaSUREs project (its-live.jpl.nasa.gov)</dd><dt><span>autoRIFT_parameter_file :</span></dt><dd>http://its-live-data.s3.amazonaws.com/autorift_parameters/v001/autorift_landice_0120m.shp</dd><dt><span>datacube_software_version :</span></dt><dd>1.0</dd><dt><span>date_created :</span></dt><dd>25-Sep-2023 22:55:04</dd><dt><span>date_updated :</span></dt><dd>25-Sep-2023 22:55:04</dd><dt><span>geo_polygon :</span></dt><dd>[[-141.91122711902466, 59.991418873895434], [-141.96346852648804, 60.20581365570371], [-142.01650174472292, 60.420390625252345], [-142.0703448201576, 60.63514798270625], [-142.12501634890182, 60.85008390249138], [-142.5653210684323, 60.82238129995041], [-143.00472885729283, 60.79303336456097], [-143.44319092917664, 60.76204591313584], [-143.88065915052024, 60.72942506278064], [-143.8129016377444, 60.5155194536589], [-143.7461622625552, 60.30177766503498], [-143.6804184250713, 60.08820184313313], [-143.61564818416412, 59.87479409917137], [-143.1908613764634, 59.90632723723632], [-142.76516601842533, 59.93627943895268], [-142.33860633623624, 59.96464509520569], [-141.91122711902466, 59.991418873895434]]</dd><dt><span>institution :</span></dt><dd>NASA Jet Propulsion Laboratory (JPL), California Institute of Technology</dd><dt><span>latitude :</span></dt><dd>60.36</dd><dt><span>longitude :</span></dt><dd>-142.88</dd><dt><span>proj_polygon :</span></dt><dd>[[-3300000, 400000], [-3275000.0, 400000.0], [-3250000.0, 400000.0], [-3225000.0, 400000.0], [-3200000, 400000], [-3200000.0, 425000.0], [-3200000.0, 450000.0], [-3200000.0, 475000.0], [-3200000, 500000], [-3225000.0, 500000.0], [-3250000.0, 500000.0], [-3275000.0, 500000.0], [-3300000, 500000], [-3300000.0, 475000.0], [-3300000.0, 450000.0], [-3300000.0, 425000.0], [-3300000, 400000]]</dd><dt><span>projection :</span></dt><dd>3413</dd><dt><span>s3 :</span></dt><dd>s3://its-live-data/datacubes/v2/N60W140/ITS_LIVE_vel_EPSG3413_G0120_X-3250000_Y450000.zarr</dd><dt><span>skipped_granules :</span></dt><dd>s3://its-live-data/datacubes/v2/N60W140/ITS_LIVE_vel_EPSG3413_G0120_X-3250000_Y450000.json</dd><dt><span>time_standard_img1 :</span></dt><dd>UTC</dd><dt><span>time_standard_img2 :</span></dt><dd>UTC</dd><dt><span>title :</span></dt><dd>ITS_LIVE datacube of image pair velocities</dd><dt><span>url :</span></dt><dd>https://its-live-data.s3.amazonaws.com/datacubes/v2/N60W140/ITS_LIVE_vel_EPSG3413_G0120_X-3250000_Y450000.zarr</dd></dl></div></li></ul></div></div>
</div>
</div>
<p>The <code>glacier_centerline</code> object contains the same RGIID and name information as the first two objects. In addition, it contains OGGM centerline data that are stored as geopandas GeodataFrames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>glacier_centerline.main_centerline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RGIID</th>
<th data-quarto-table-cell-role="th">SEGMENT_ID</th>
<th data-quarto-table-cell-role="th">LE_SEGMENT</th>
<th data-quarto-table-cell-role="th">MAIN</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">19617</td>
<td>RGI60-01.13635</td>
<td>40</td>
<td>212562.0</td>
<td>1</td>
<td>LINESTRING (522733.337 6719455.665, 522730.077...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Each of these objects are meant to act as cotainers to intuitively and efficiently store different types of data as you process and continue to work with ITS_LIVE data.</p>
<p>The previous steps demonstrated the data access and organization functionality of ITS_LIVE_TOOl. The subsequent sections of this notebook will demonstrate different processing methodologies for working with this dataset.</p>
</section>
<section id="if-youve-selected-multiple-glaciers-follow-these-examples" class="level4">
<h4 class="anchored" data-anchor-id="if-youve-selected-multiple-glaciers-follow-these-examples">If you’ve selected multiple glaciers, follow these examples:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>glacier0, glacier1 <span class="op">=</span> obj_setup.create_multiple_glacier_objs(data_map)[<span class="dv">0</span>], obj_setup.create_multiple_glacier_objs(data_map)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>glacier_point_ls <span class="op">=</span> obj_setup.create_multiple_glacier_point_objs(data_map)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>glacier_pt0, glacier_pt1 <span class="op">=</span> glacier_point_ls[<span class="dv">0</span>], glacier_point_ls[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>original xy [-141.34499544222683, 60.45529919026818] 4326 maps to datacube (-3250454.7365773427, 361437.5235576865) EPSG:3413
original xy [-141.34499544222683, 60.45529919026818] 4326 maps to datacube (-3250454.7365773427, 361437.5235576865) EPSG:3413
subset and load at  58.26 seconds
original xy [-141.32575672759108, 60.65848956101137] 4326 maps to datacube (-3227246.8706271336, 357759.90272181097) EPSG:3413
original xy [-141.32575672759108, 60.65848956101137] 4326 maps to datacube (-3227246.8706271336, 357759.90272181097) EPSG:3413
subset and load at  60.11 seconds</code></pre>
</div>
</div>
</section>
</section>
<section id="manually-create-glacier-glacier_point-glacier_centerline-objects" class="level3">
<h3 class="anchored" data-anchor-id="manually-create-glacier-glacier_point-glacier_centerline-objects">Manually create <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier"><code>Glacier</code></a>, <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_point"><code>Glacier_Point</code></a>, <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_centerline"><code>Glacier_Centerline</code></a> objects</h3>
<p>Create objects that contain the clicked data from the above map widget.<br>
These are <code>coords</code>, <code>gpdf</code>, <code>urls</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>coords, gpdf, urls <span class="op">=</span> obj_setup.return_clicked_info(data_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>You have 2 glaciers selected</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>coords</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[60.37791914446092, -143.04795214410368],
 [60.36705675717361, -143.64435229781114]]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> <span class="st">'label'</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>var_ls <span class="op">=</span> [<span class="st">'v'</span>,<span class="st">'vy'</span>,<span class="st">'vx'</span>,<span class="st">'v_error'</span>,<span class="st">'mapping'</span>,<span class="st">'satellite_img1'</span>,<span class="st">'satellite_img2'</span>,<span class="st">'acquisition_date_img1'</span>, <span class="st">'acquisition_date_img2'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>glacier_manual <span class="op">=</span> obj_setup.Glacier(gpdf[<span class="dv">0</span>][<span class="st">'NAME'</span>].iloc[<span class="dv">0</span>], gpdf[<span class="dv">0</span>][<span class="st">'RGIID'</span>].iloc[<span class="dv">0</span>], <span class="bu">str</span>(gpdf[<span class="dv">0</span>].estimate_utm_crs()), <span class="st">'manual'</span>, rgi_outline_from_widget <span class="op">=</span> <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>glacier_manual.name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'Bering Glacier'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>glacier_manual.rgi_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'RGI60-01.13635'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>glacier_manual.outline_prj.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Projected CRS: EPSG:32607&gt;
Name: WGS 84 / UTM zone 7N
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Between 144°W and 138°W, northern hemisphere between equator and 84°N, onshore and offshore. Canada - British Columbia (BC); Yukon. United States (USA) - Alaska (AK).
- bounds: (-144.0, 0.0, -138.0, 84.0)
Coordinate Operation:
- name: UTM zone 7N
- method: Transverse Mercator
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>glacier_pt <span class="op">=</span> obj_setup.Glacier_Point(glacier.name, <span class="st">'acc. zone'</span>, glacier.rgi_id, [coords[<span class="dv">0</span>][<span class="dv">1</span>], coords[<span class="dv">0</span>][<span class="dv">0</span>]], var_ls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>original xy [-143.04795214410368, 60.37791914446092] 4326 maps to datacube (-3247134.1548154885, 459126.5490621218) EPSG:3413
original xy [-143.04795214410368, 60.37791914446092] 4326 maps to datacube (-3247134.1548154885, 459126.5490621218) EPSG:3413
subset and load at  62.53 seconds</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>glacier_centerline <span class="op">=</span> obj_setup.Glacier_Centerline(<span class="st">'Jorge Montt'</span>, <span class="st">'RGI60-17.06074'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="glacier_point" class="level3">
<h3 class="anchored" data-anchor-id="glacier_point"><a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_point"><code>Glacier_Point</code></a></h3>
<p>This object inherits name and RGIID attributes from the <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier"><code>Glacier</code></a> object described aboev (or you can input them manually). It takes the coordinate information specified in the widget and list of variables of interest and returns an object containing ITS_LIVE image pair time series datasets for the specified point anda 3x3 pixel cube surrounding the specified point. Check out the docs for a description of all of the attributes and methods associated with this object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>coords</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[61.445551290803365, -147.96202722979135]]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>glacier_pt <span class="op">=</span> obj_setup.Glacier_Point(glacier.name, <span class="st">'acc. zone'</span>, glacier.rgi_id, [coords[<span class="dv">0</span>][<span class="dv">1</span>], coords[<span class="dv">0</span>][<span class="dv">0</span>]], var_ls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>original xy [-147.96202722979135, 61.445551290803365] 4326 maps to datacube (-3075868.4013177734, 707973.3167825146) EPSG:3413
original xy [-147.96202722979135, 61.445551290803365] 4326 maps to datacube (-3075868.4013177734, 707973.3167825146) EPSG:3413
subset and load at  48.89 seconds</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>glacier_pt.cube_around_point</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt;
Dimensions:                (mid_date: 13831, x: 3, y: 3)
Coordinates:
  * mid_date               (mid_date) datetime64[ns] 2020-02-26T21:15:44.1906...
  * x                      (x) float64 -3.076e+06 -3.076e+06 -3.076e+06
  * y                      (y) float64 7.081e+05 7.079e+05 7.078e+05
    step_count             (mid_date) int64 1 6 7 8 ... 53266 53268 53273 53285
    mapping                int64 0
Data variables:
    v                      (mid_date, y, x) float32 nan nan nan ... nan nan nan
    vy                     (mid_date, y, x) float32 nan nan nan ... nan nan nan
    vx                     (mid_date, y, x) float32 nan nan nan ... nan nan nan
    v_error                (mid_date, y, x) float32 nan nan nan ... nan nan nan
    satellite_img1         (mid_date) object '2B' '5' '2B' '7' ... '7' '8' '8'
    satellite_img2         (mid_date) object '2B' '5' '2B' '7' ... '8' '8' '8'
    acquisition_date_img1  (mid_date) datetime64[ns] 2019-06-26T21:15:19.0000...
    acquisition_date_img2  (mid_date) datetime64[ns] 2020-10-28T21:16:09 ... ...
    img_separation         (mid_date) float64 491.0 305.0 340.0 ... 352.0 17.0
Attributes: (12/19)
    Conventions:                CF-1.8
    GDAL_AREA_OR_POINT:         Area
    author:                     ITS_LIVE, a NASA MEaSUREs project (its-live.j...
    autoRIFT_parameter_file:    http://its-live-data.s3.amazonaws.com/autorif...
    datacube_software_version:  1.0
    date_created:               03-Oct-2023 04:28:15
    ...                         ...
    s3:                         s3://its-live-data/datacubes/v2/N60W140/ITS_L...
    skipped_granules:           s3://its-live-data/datacubes/v2/N60W140/ITS_L...
    time_standard_img1:         UTC
    time_standard_img2:         UTC
    title:                      ITS_LIVE datacube of image pair velocities
    url:                        https://its-live-data.s3.amazonaws.com/datacu...</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-55e5da10-4eba-43fa-af85-ee092173af19" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-55e5da10-4eba-43fa-af85-ee092173af19" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">mid_date</span>: 13831</li><li><span class="xr-has-index">x</span>: 3</li><li><span class="xr-has-index">y</span>: 3</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-dcc42c2b-685e-47d1-a927-d41cba5b09ba" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-dcc42c2b-685e-47d1-a927-d41cba5b09ba" class="xr-section-summary">Coordinates: <span>(5)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">mid_date</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2020-02-26T21:15:44.190626304 .....</div><input id="attrs-a3235126-f1b2-449d-abba-9d13c1728f4e" class="xr-var-attrs-in" type="checkbox"><label for="attrs-a3235126-f1b2-449d-abba-9d13c1728f4e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-5ee6ca1a-4f2e-45d3-b226-a0ae3459fd32" class="xr-var-data-in" type="checkbox"><label for="data-5ee6ca1a-4f2e-45d3-b226-a0ae3459fd32" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>midpoint of image 1 and image 2 acquisition date and time with granule's centroid longitude and latitude as microseconds</dd><dt><span>standard_name :</span></dt><dd>image_pair_center_date_with_time_separation</dd></dl></div><div class="xr-var-data"><pre>array(['2020-02-26T21:15:44.190626304', '2004-03-15T20:41:54.249558016',
       '2022-04-14T21:25:39.211025920', ..., '2018-01-13T21:02:14.970299904',
       '2019-12-27T07:04:10.358426112', '2020-06-28T07:04:07.431471104'],
      dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">-3.076e+06 -3.076e+06 -3.076e+06</div><input id="attrs-34588db1-16b8-4449-9381-233834081c19" class="xr-var-attrs-in" type="checkbox"><label for="attrs-34588db1-16b8-4449-9381-233834081c19" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-c4bc2c00-bfa1-4573-9cbe-7eb09c4e4524" class="xr-var-data-in" type="checkbox"><label for="data-c4bc2c00-bfa1-4573-9cbe-7eb09c4e4524" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>x coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_x_coordinate</dd><dt><span>axis :</span></dt><dd>X</dd><dt><span>long_name :</span></dt><dd>x coordinate of projection</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([-3076027.5, -3075907.5, -3075787.5])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">7.081e+05 7.079e+05 7.078e+05</div><input id="attrs-b6ddd680-1c84-41b9-9427-6aaab131af45" class="xr-var-attrs-in" type="checkbox"><label for="attrs-b6ddd680-1c84-41b9-9427-6aaab131af45" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-b2a7b45c-6bec-4468-8341-5d79ba44d654" class="xr-var-data-in" type="checkbox"><label for="data-b2a7b45c-6bec-4468-8341-5d79ba44d654" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>y coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_y_coordinate</dd><dt><span>axis :</span></dt><dd>Y</dd><dt><span>long_name :</span></dt><dd>y coordinate of projection</dd><dt><span>units :</span></dt><dd>metre</dd></dl></div><div class="xr-var-data"><pre>array([708067.5, 707947.5, 707827.5])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>step_count</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">1 6 7 8 ... 53266 53268 53273 53285</div><input id="attrs-6d288e09-8478-463e-967e-575950e9627e" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-6d288e09-8478-463e-967e-575950e9627e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-2090c3b3-7bf7-405a-96bd-e9f80d8fb88b" class="xr-var-data-in" type="checkbox"><label for="data-2090c3b3-7bf7-405a-96bd-e9f80d8fb88b" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([    1,     6,     7, ..., 53268, 53273, 53285])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>mapping</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0</div><input id="attrs-ec9db8bb-d262-4c88-ab56-b0e72fccb96c" class="xr-var-attrs-in" type="checkbox"><label for="attrs-ec9db8bb-d262-4c88-ab56-b0e72fccb96c" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-635063dc-29ad-44f8-9e5e-d178affef158" class="xr-var-data-in" type="checkbox"><label for="data-635063dc-29ad-44f8-9e5e-d178affef158" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>crs_wkt :</span></dt><dd>PROJCS["WGS 84 / NSIDC Sea Ice Polar Stereographic North",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Polar_Stereographic"],PARAMETER["latitude_of_origin",70],PARAMETER["central_meridian",-45],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",SOUTH],AXIS["Northing",SOUTH],AUTHORITY["EPSG","3413"]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314245179</dd><dt><span>inverse_flattening :</span></dt><dd>298.257223563</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>WGS 84</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>WGS 84</dd><dt><span>horizontal_datum_name :</span></dt><dd>World Geodetic System 1984</dd><dt><span>projected_crs_name :</span></dt><dd>WGS 84 / NSIDC Sea Ice Polar Stereographic North</dd><dt><span>grid_mapping_name :</span></dt><dd>polar_stereographic</dd><dt><span>standard_parallel :</span></dt><dd>70.0</dd><dt><span>straight_vertical_longitude_from_pole :</span></dt><dd>-45.0</dd><dt><span>false_easting :</span></dt><dd>0.0</dd><dt><span>false_northing :</span></dt><dd>0.0</dd><dt><span>spatial_ref :</span></dt><dd>PROJCS["WGS 84 / NSIDC Sea Ice Polar Stereographic North",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Polar_Stereographic"],PARAMETER["latitude_of_origin",70],PARAMETER["central_meridian",-45],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",SOUTH],AXIS["Northing",SOUTH],AUTHORITY["EPSG","3413"]]</dd><dt><span>GeoTransform :</span></dt><dd>-3076087.5 120.0 0.0 708127.5 0.0 -120.0</dd></dl></div><div class="xr-var-data"><pre>array(0)</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-83bc7d1d-791b-4881-a8eb-9981ae51aa3a" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-83bc7d1d-791b-4881-a8eb-9981ae51aa3a" class="xr-section-summary">Data variables: <span>(9)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>v</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">nan nan nan nan ... nan nan nan nan</div><input id="attrs-f30185b4-d8cc-4276-8ea3-6f82b75264de" class="xr-var-attrs-in" type="checkbox"><label for="attrs-f30185b4-d8cc-4276-8ea3-6f82b75264de" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-e243a7e9-725c-442b-a404-cfe65c7baba3" class="xr-var-data-in" type="checkbox"><label for="data-e243a7e9-725c-442b-a404-cfe65c7baba3" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity magnitude</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       ...,

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>vy</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">nan nan nan nan ... nan nan nan nan</div><input id="attrs-999a62f7-e9b5-408f-bd42-08b71c2e88ae" class="xr-var-attrs-in" type="checkbox"><label for="attrs-999a62f7-e9b5-408f-bd42-08b71c2e88ae" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-63d824c4-c08c-49e2-9eb8-5d523a2cc827" class="xr-var-data-in" type="checkbox"><label for="data-63d824c4-c08c-49e2-9eb8-5d523a2cc827" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity component in y direction</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_y_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       ...,

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>vx</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">nan nan nan nan ... nan nan nan nan</div><input id="attrs-98bedb5f-39d0-458f-ad6e-7c25ef8047cd" class="xr-var-attrs-in" type="checkbox"><label for="attrs-98bedb5f-39d0-458f-ad6e-7c25ef8047cd" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-0d447f0f-13a2-4c81-9774-b8dfb17ff26e" class="xr-var-data-in" type="checkbox"><label for="data-0d447f0f-13a2-4c81-9774-b8dfb17ff26e" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity component in x direction</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_x_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       ...,

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>v_error</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">nan nan nan nan ... nan nan nan nan</div><input id="attrs-d483d13e-c4c8-42ca-bce8-4bb1f7eb7607" class="xr-var-attrs-in" type="checkbox"><label for="attrs-d483d13e-c4c8-42ca-bce8-4bb1f7eb7607" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-3af526d9-3bcf-48a6-8092-714b47d95c5f" class="xr-var-data-in" type="checkbox"><label for="data-3af526d9-3bcf-48a6-8092-714b47d95c5f" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity magnitude error</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>velocity_error</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       ...,

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]],

       [[nan, nan, nan],
        [nan, nan, nan],
        [nan, nan, nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>satellite_img1</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">object</div><div class="xr-var-preview xr-preview">'2B' '5' '2B' '7' ... '7' '8' '8'</div><input id="attrs-1274dbf2-65e8-4933-a690-d486d57b6753" class="xr-var-attrs-in" type="checkbox"><label for="attrs-1274dbf2-65e8-4933-a690-d486d57b6753" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-b6aaa4e0-17d4-48ec-96ad-1d983e3af6b3" class="xr-var-data-in" type="checkbox"><label for="data-b6aaa4e0-17d4-48ec-96ad-1d983e3af6b3" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>id of the satellite that acquired image 1</dd><dt><span>standard_name :</span></dt><dd>image1_satellite</dd></dl></div><div class="xr-var-data"><pre>array(['2B', '5', '2B', ..., '7', '8', '8'], dtype=object)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>satellite_img2</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">object</div><div class="xr-var-preview xr-preview">'2B' '5' '2B' '7' ... '8' '8' '8'</div><input id="attrs-61c5956e-a0ef-4464-8749-5ebf60158616" class="xr-var-attrs-in" type="checkbox"><label for="attrs-61c5956e-a0ef-4464-8749-5ebf60158616" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-a74cc111-5071-4107-8844-f96e05861591" class="xr-var-data-in" type="checkbox"><label for="data-a74cc111-5071-4107-8844-f96e05861591" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>id of the satellite that acquired image 2</dd><dt><span>standard_name :</span></dt><dd>image2_satellite</dd></dl></div><div class="xr-var-data"><pre>array(['2B', '5', '2B', ..., '8', '8', '8'], dtype=object)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>acquisition_date_img1</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2019-06-26T21:15:19.000000256 .....</div><input id="attrs-bbdfa950-3753-4d5a-826e-a067dd5a1f70" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-bbdfa950-3753-4d5a-826e-a067dd5a1f70" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-506efd94-6b4e-4d82-87be-1bf855b42d15" class="xr-var-data-in" type="checkbox"><label for="data-506efd94-6b4e-4d82-87be-1bf855b42d15" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array(['2019-06-26T21:15:19.000000256', '2003-10-15T20:39:20.588030976',
       '2021-10-26T21:25:59.000000256', ...,
       '2017-09-11T21:04:03.087996928', '2019-07-04T07:04:16.857030656',
       '2020-06-20T07:04:03.478413056'], dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>acquisition_date_img2</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2020-10-28T21:16:09 ... 2020-07-...</div><input id="attrs-cec0ccfc-4aaf-4c87-bc24-a5a7e2790e7d" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-cec0ccfc-4aaf-4c87-bc24-a5a7e2790e7d" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-c9252dd4-51ec-49e6-8697-acc22957af29" class="xr-var-data-in" type="checkbox"><label for="data-c9252dd4-51ec-49e6-8697-acc22957af29" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array(['2020-10-28T21:16:09.000000000', '2004-08-14T20:44:27.849055872',
       '2022-10-01T21:25:19.000000000', ...,
       '2018-05-17T21:00:26.510779904', '2020-06-20T07:04:03.478413056',
       '2020-07-06T07:04:10.983290112'], dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>img_separation</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">491.0 305.0 340.0 ... 352.0 17.0</div><input id="attrs-96916ecc-11cb-470b-b62f-9a1dad866292" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-96916ecc-11cb-470b-b62f-9a1dad866292" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-312c0ba5-439d-42a8-b56d-16bacbd572aa" class="xr-var-data-in" type="checkbox"><label for="data-312c0ba5-439d-42a8-b56d-16bacbd572aa" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([491., 305., 340., ..., 248., 352.,  17.])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-aec84c88-3e50-4988-8e27-ca79cecd882a" class="xr-section-summary-in" type="checkbox"><label for="section-aec84c88-3e50-4988-8e27-ca79cecd882a" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>mid_date</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-ae35dc00-0b50-4d07-ac01-a9f8d6b55b34" class="xr-index-data-in" type="checkbox"><label for="index-ae35dc00-0b50-4d07-ac01-a9f8d6b55b34" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(DatetimeIndex(['2020-02-26 21:15:44.190626304',
               '2004-03-15 20:41:54.249558016',
               '2022-04-14 21:25:39.211025920',
               '2000-10-30 20:52:34.601543936',
               '2019-03-13 21:15:14.190225920',
               '2019-12-06 09:15:20.190706176',
               '2020-08-14 21:15:21.200715008',
               '2019-03-11 21:25:29.181021696',
               '2021-06-16 09:25:20.210305024',
               '2020-01-13 09:25:30.190608896',
               ...
               '2017-11-10 21:02:48.296647936',
               '2017-05-10 21:02:54.593886976',
               '2017-10-17 21:02:51.426091776',
               '2019-12-19 07:04:08.734586880',
               '2016-12-21 21:01:24.286437120',
               '2015-01-05 20:59:48.743781888',
               '2013-05-23 20:59:42.758845952',
               '2018-01-13 21:02:14.970299904',
               '2019-12-27 07:04:10.358426112',
               '2020-06-28 07:04:07.431471104'],
              dtype='datetime64[ns]', name='mid_date', length=13831, freq=None))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-3934a905-0dfe-4019-a025-b596c9325e6b" class="xr-index-data-in" type="checkbox"><label for="index-3934a905-0dfe-4019-a025-b596c9325e6b" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Float64Index([-3076027.5, -3075907.5, -3075787.5], dtype='float64', name='x'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-47eaaeb7-cb3b-4a4e-9645-a87b83c7c4e5" class="xr-index-data-in" type="checkbox"><label for="index-47eaaeb7-cb3b-4a4e-9645-a87b83c7c4e5" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Float64Index([708067.5, 707947.5, 707827.5], dtype='float64', name='y'))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-4d85af18-5b4c-417c-8b53-dec68e9b8953" class="xr-section-summary-in" type="checkbox"><label for="section-4d85af18-5b4c-417c-8b53-dec68e9b8953" class="xr-section-summary">Attributes: <span>(19)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>Conventions :</span></dt><dd>CF-1.8</dd><dt><span>GDAL_AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>author :</span></dt><dd>ITS_LIVE, a NASA MEaSUREs project (its-live.jpl.nasa.gov)</dd><dt><span>autoRIFT_parameter_file :</span></dt><dd>http://its-live-data.s3.amazonaws.com/autorift_parameters/v001/autorift_landice_0120m.shp</dd><dt><span>datacube_software_version :</span></dt><dd>1.0</dd><dt><span>date_created :</span></dt><dd>03-Oct-2023 04:28:15</dd><dt><span>date_updated :</span></dt><dd>03-Oct-2023 04:28:15</dd><dt><span>geo_polygon :</span></dt><dd>[[-147.72435568542238, 61.256565131502], [-147.82439810223514, 61.46836997708816], [-147.92599912470595, 61.68028219703766], [-148.02919480794375, 61.89229840144163], [-148.13402230639633, 62.10441512674958], [-148.58599120788892, 62.054078250278586], [-149.03624346792648, 62.00208535775977], [-149.48473356032298, 61.94844718523407], [-149.93141717813754, 61.893174727380945], [-149.81346411880466, 61.682888460616276], [-149.6973192795119, 61.47267643420667], [-149.58294232948407, 61.2625426718196], [-149.4702941000659, 61.05249110806707], [-149.03624346792648, 61.105897743779785], [-148.60054251665875, 61.15771897647252], [-148.1632324896995, 61.20794472007768], [-147.72435568542238, 61.256565131502]]</dd><dt><span>institution :</span></dt><dd>NASA Jet Propulsion Laboratory (JPL), California Institute of Technology</dd><dt><span>latitude :</span></dt><dd>61.58</dd><dt><span>longitude :</span></dt><dd>-148.81</dd><dt><span>proj_polygon :</span></dt><dd>[[-3100000, 700000], [-3075000.0, 700000.0], [-3050000.0, 700000.0], [-3025000.0, 700000.0], [-3000000, 700000], [-3000000.0, 725000.0], [-3000000.0, 750000.0], [-3000000.0, 775000.0], [-3000000, 800000], [-3025000.0, 800000.0], [-3050000.0, 800000.0], [-3075000.0, 800000.0], [-3100000, 800000], [-3100000.0, 775000.0], [-3100000.0, 750000.0], [-3100000.0, 725000.0], [-3100000, 700000]]</dd><dt><span>projection :</span></dt><dd>3413</dd><dt><span>s3 :</span></dt><dd>s3://its-live-data/datacubes/v2/N60W140/ITS_LIVE_vel_EPSG3413_G0120_X-3050000_Y750000.zarr</dd><dt><span>skipped_granules :</span></dt><dd>s3://its-live-data/datacubes/v2/N60W140/ITS_LIVE_vel_EPSG3413_G0120_X-3050000_Y750000.json</dd><dt><span>time_standard_img1 :</span></dt><dd>UTC</dd><dt><span>time_standard_img2 :</span></dt><dd>UTC</dd><dt><span>title :</span></dt><dd>ITS_LIVE datacube of image pair velocities</dd><dt><span>url :</span></dt><dd>https://its-live-data.s3.amazonaws.com/datacubes/v2/N60W140/ITS_LIVE_vel_EPSG3413_G0120_X-3050000_Y750000.zarr</dd></dl></div></li></ul></div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>glacier_pt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewbox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewbox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class="xr-text-repr-fallback">&lt;xarray.Dataset&gt;
Dimensions:                (mid_date: 3906, y: 83, x: 83)
Coordinates:
    mapping                int64 0
  * mid_date               (mid_date) datetime64[ns] 2020-01-26T14:27:11.2001...
  * x                      (x) float64 6.017e+05 6.019e+05 ... 6.116e+05
  * y                      (y) float64 4.633e+06 4.633e+06 ... 4.623e+06
    step_count             (mid_date) int64 7 29 30 38 ... 31281 31283 31302
Data variables:
    v                      (mid_date, y, x) float32 37.0 25.0 9.0 ... nan nan
    vy                     (mid_date, y, x) float32 -2.0 -11.0 2.0 ... nan nan
    vx                     (mid_date, y, x) float32 36.0 23.0 9.0 ... nan nan
    v_error                (mid_date, y, x) float32 26.0 26.0 26.0 ... nan nan
    satellite_img1         (mid_date) object '2A' '2A' '1A' '2A' ... '8' '8' '8'
    satellite_img2         (mid_date) object '2A' '2A' '1A' '2B' ... '7' '9' '8'
    acquisition_date_img1  (mid_date) datetime64[ns] 2020-01-01T14:27:30.9999...
    acquisition_date_img2  (mid_date) datetime64[ns] 2020-02-20T14:26:51 ... ...
    img_separation         (mid_date) float64 50.0 260.0 12.0 ... 536.0 16.0
Attributes: (12/19)
    Conventions:                CF-1.8
    GDAL_AREA_OR_POINT:         Area
    author:                     ITS_LIVE, a NASA MEaSUREs project (its-live.j...
    autoRIFT_parameter_file:    http://its-live-data.s3.amazonaws.com/autorif...
    datacube_software_version:  1.0
    date_created:               25-Sep-2023 21:36:13
    ...                         ...
    s3:                         s3://its-live-data/datacubes/v2/S40W070/ITS_L...
    skipped_granules:           s3://its-live-data/datacubes/v2/S40W070/ITS_L...
    time_standard_img1:         UTC
    time_standard_img2:         UTC
    title:                      ITS_LIVE datacube of image pair velocities
    url:                        https://its-live-data.s3.amazonaws.com/datacu...</pre><div class="xr-wrap" style="display:none"><div class="xr-header"><div class="xr-obj-type">xarray.Dataset</div></div><ul class="xr-sections"><li class="xr-section-item"><input id="section-5513e85f-4a93-41f6-b76c-b90ae3d1713e" class="xr-section-summary-in" type="checkbox" disabled=""><label for="section-5513e85f-4a93-41f6-b76c-b90ae3d1713e" class="xr-section-summary" title="Expand/collapse section">Dimensions:</label><div class="xr-section-inline-details"><ul class="xr-dim-list"><li><span class="xr-has-index">mid_date</span>: 3906</li><li><span class="xr-has-index">y</span>: 83</li><li><span class="xr-has-index">x</span>: 83</li></ul></div><div class="xr-section-details"></div></li><li class="xr-section-item"><input id="section-fa358b93-b92b-4a1e-8e75-39dc67a31a08" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-fa358b93-b92b-4a1e-8e75-39dc67a31a08" class="xr-section-summary">Coordinates: <span>(5)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>mapping</span></div><div class="xr-var-dims">()</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">0</div><input id="attrs-f372e188-7a57-420d-a5cf-ff07b347944d" class="xr-var-attrs-in" type="checkbox"><label for="attrs-f372e188-7a57-420d-a5cf-ff07b347944d" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-2cc2ab6c-68e4-46d5-92ae-474137878f8a" class="xr-var-data-in" type="checkbox"><label for="data-2cc2ab6c-68e4-46d5-92ae-474137878f8a" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>crs_wkt :</span></dt><dd>PROJCS["WGS 84 / UTM zone 18S",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-75],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",10000000],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32718"]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314245179</dd><dt><span>inverse_flattening :</span></dt><dd>298.257223563</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>WGS 84</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>WGS 84</dd><dt><span>horizontal_datum_name :</span></dt><dd>World Geodetic System 1984</dd><dt><span>projected_crs_name :</span></dt><dd>WGS 84 / UTM zone 18S</dd><dt><span>grid_mapping_name :</span></dt><dd>transverse_mercator</dd><dt><span>latitude_of_projection_origin :</span></dt><dd>0.0</dd><dt><span>longitude_of_central_meridian :</span></dt><dd>-75.0</dd><dt><span>false_easting :</span></dt><dd>500000.0</dd><dt><span>false_northing :</span></dt><dd>10000000.0</dd><dt><span>scale_factor_at_central_meridian :</span></dt><dd>0.9996</dd><dt><span>spatial_ref :</span></dt><dd>PROJCS["WGS 84 / UTM zone 18S",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-75],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",10000000],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32718"]]</dd></dl></div><div class="xr-var-data"><pre>array(0)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">mid_date</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2020-01-26T14:27:11.200101376 .....</div><input id="attrs-dda6ca10-a5f1-45a3-9ddb-c09960ce6201" class="xr-var-attrs-in" type="checkbox"><label for="attrs-dda6ca10-a5f1-45a3-9ddb-c09960ce6201" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-ef95749a-a2c9-4ba8-87b6-490d19504802" class="xr-var-data-in" type="checkbox"><label for="data-ef95749a-a2c9-4ba8-87b6-490d19504802" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>midpoint of image 1 and image 2 acquisition date and time with granule's centroid longitude and latitude as microseconds</dd><dt><span>standard_name :</span></dt><dd>image_pair_center_date_with_time_separation</dd></dl></div><div class="xr-var-data"><pre>array(['2020-01-26T14:27:11.200101376', '2020-09-07T14:27:31.200430080',
       '2022-10-26T23:57:28.428462080', ..., '2018-01-17T14:32:41.519959040',
       '2021-08-29T14:31:49.364434176', '2017-03-16T14:25:24.933592832'],
      dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">x</span></div><div class="xr-var-dims">(x)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">6.017e+05 6.019e+05 ... 6.116e+05</div><input id="attrs-34cf7fb5-531f-475a-b325-1c3b84526e38" class="xr-var-attrs-in" type="checkbox"><label for="attrs-34cf7fb5-531f-475a-b325-1c3b84526e38" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-2ef0ae0d-13cf-4a18-b917-9784dedba320" class="xr-var-data-in" type="checkbox"><label for="data-2ef0ae0d-13cf-4a18-b917-9784dedba320" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>x coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_x_coordinate</dd></dl></div><div class="xr-var-data"><pre>array([601732.5, 601852.5, 601972.5, 602092.5, 602212.5, 602332.5, 602452.5,
       602572.5, 602692.5, 602812.5, 602932.5, 603052.5, 603172.5, 603292.5,
       603412.5, 603532.5, 603652.5, 603772.5, 603892.5, 604012.5, 604132.5,
       604252.5, 604372.5, 604492.5, 604612.5, 604732.5, 604852.5, 604972.5,
       605092.5, 605212.5, 605332.5, 605452.5, 605572.5, 605692.5, 605812.5,
       605932.5, 606052.5, 606172.5, 606292.5, 606412.5, 606532.5, 606652.5,
       606772.5, 606892.5, 607012.5, 607132.5, 607252.5, 607372.5, 607492.5,
       607612.5, 607732.5, 607852.5, 607972.5, 608092.5, 608212.5, 608332.5,
       608452.5, 608572.5, 608692.5, 608812.5, 608932.5, 609052.5, 609172.5,
       609292.5, 609412.5, 609532.5, 609652.5, 609772.5, 609892.5, 610012.5,
       610132.5, 610252.5, 610372.5, 610492.5, 610612.5, 610732.5, 610852.5,
       610972.5, 611092.5, 611212.5, 611332.5, 611452.5, 611572.5])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span class="xr-has-index">y</span></div><div class="xr-var-dims">(y)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">4.633e+06 4.633e+06 ... 4.623e+06</div><input id="attrs-e9bb4d43-7b3d-4e6a-a13d-73d5d0570ada" class="xr-var-attrs-in" type="checkbox"><label for="attrs-e9bb4d43-7b3d-4e6a-a13d-73d5d0570ada" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-0d07c79a-2bf4-4494-8b74-82f0e502aed1" class="xr-var-data-in" type="checkbox"><label for="data-0d07c79a-2bf4-4494-8b74-82f0e502aed1" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>y coordinate of projection</dd><dt><span>standard_name :</span></dt><dd>projection_y_coordinate</dd></dl></div><div class="xr-var-data"><pre>array([4633267.5, 4633147.5, 4633027.5, 4632907.5, 4632787.5, 4632667.5,
       4632547.5, 4632427.5, 4632307.5, 4632187.5, 4632067.5, 4631947.5,
       4631827.5, 4631707.5, 4631587.5, 4631467.5, 4631347.5, 4631227.5,
       4631107.5, 4630987.5, 4630867.5, 4630747.5, 4630627.5, 4630507.5,
       4630387.5, 4630267.5, 4630147.5, 4630027.5, 4629907.5, 4629787.5,
       4629667.5, 4629547.5, 4629427.5, 4629307.5, 4629187.5, 4629067.5,
       4628947.5, 4628827.5, 4628707.5, 4628587.5, 4628467.5, 4628347.5,
       4628227.5, 4628107.5, 4627987.5, 4627867.5, 4627747.5, 4627627.5,
       4627507.5, 4627387.5, 4627267.5, 4627147.5, 4627027.5, 4626907.5,
       4626787.5, 4626667.5, 4626547.5, 4626427.5, 4626307.5, 4626187.5,
       4626067.5, 4625947.5, 4625827.5, 4625707.5, 4625587.5, 4625467.5,
       4625347.5, 4625227.5, 4625107.5, 4624987.5, 4624867.5, 4624747.5,
       4624627.5, 4624507.5, 4624387.5, 4624267.5, 4624147.5, 4624027.5,
       4623907.5, 4623787.5, 4623667.5, 4623547.5, 4623427.5])</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>step_count</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">int64</div><div class="xr-var-preview xr-preview">7 29 30 38 ... 31281 31283 31302</div><input id="attrs-ad098750-c78b-47c2-b3f3-b044e09cd16b" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-ad098750-c78b-47c2-b3f3-b044e09cd16b" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-2ba3d558-b4cc-4ad7-bcaa-4b5b417004f3" class="xr-var-data-in" type="checkbox"><label for="data-2ba3d558-b4cc-4ad7-bcaa-4b5b417004f3" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([    7,    29,    30, ..., 31281, 31283, 31302])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-d8c95992-3353-4bf1-a1be-f705efb122ad" class="xr-section-summary-in" type="checkbox" checked=""><label for="section-d8c95992-3353-4bf1-a1be-f705efb122ad" class="xr-section-summary">Data variables: <span>(9)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-var-name"><span>v</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">37.0 25.0 9.0 37.0 ... nan nan nan</div><input id="attrs-d5cc7205-f46a-4d5d-93c3-af755ba2f824" class="xr-var-attrs-in" type="checkbox"><label for="attrs-d5cc7205-f46a-4d5d-93c3-af755ba2f824" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-d8e4b304-78e7-45e3-9c4d-5190d4f5624a" class="xr-var-data-in" type="checkbox"><label for="data-d8e4b304-78e7-45e3-9c4d-5190d4f5624a" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity magnitude</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[ 37.,  25.,   9., ...,  nan,  nan,  nan],
        [ 37.,  33.,  47., ...,  nan,  nan,  nan],
        [ 41.,  37.,  55., ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ 20.,  92., 167., ...,  28.,  49.,  33.],
        [ 12.,  nan, 241., ...,  45.,  75., 119.],
        [  5.,  nan,  nan, ...,  46.,   3.,  28.],
        ...,
...
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[  1.,   3.,   4., ...,  nan,  nan,  nan],
        [  3.,   6.,   6., ...,  12.,  10.,   9.],
        [  3.,   6.,   5., ...,  13.,  11.,  10.],
        ...,
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]],

       [[ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan],
        ...,
        [ nan,  nan,  nan, ..., 284., 254., 253.],
        [ nan,  nan,  nan, ..., 289., 251., 244.],
        [ nan,  nan,  nan, ...,  nan,  nan,  nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>vy</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">-2.0 -11.0 2.0 30.0 ... nan nan nan</div><input id="attrs-b4a45553-5a8d-4452-8d91-87808a18d1d5" class="xr-var-attrs-in" type="checkbox"><label for="attrs-b4a45553-5a8d-4452-8d91-87808a18d1d5" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-cdcc84cf-63d1-49a1-afd3-ca2a8ba2429d" class="xr-var-data-in" type="checkbox"><label for="data-cdcc84cf-63d1-49a1-afd3-ca2a8ba2429d" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity component in y direction</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_y_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[  -2.,  -11.,    2., ...,   nan,   nan,   nan],
        [  -2.,   -7.,  -11., ...,   nan,   nan,   nan],
        [  -2.,    2.,    7., ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[   7.,  -79., -138., ...,   23.,  -47.,   31.],
        [   5.,   nan, -225., ...,  -31.,  -53.,  -86.],
        [   0.,   nan,   nan, ...,  -45.,   -1.,   22.],
        ...,
...
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[   1.,    3.,    4., ...,   nan,   nan,   nan],
        [   2.,    6.,    6., ...,  -12.,  -10.,   -8.],
        [   2.,    5.,    4., ...,  -13.,  -11.,   -9.],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,  -36.,  -85., -111.],
        [  nan,   nan,   nan, ...,  -25.,  -52.,  -76.],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>vx</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">36.0 23.0 9.0 23.0 ... nan nan nan</div><input id="attrs-2d0a50da-44ac-48e1-bb10-4d11d3857594" class="xr-var-attrs-in" type="checkbox"><label for="attrs-2d0a50da-44ac-48e1-bb10-4d11d3857594" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-547bb509-43bc-4add-84ca-19fd1d5764ef" class="xr-var-data-in" type="checkbox"><label for="data-547bb509-43bc-4add-84ca-19fd1d5764ef" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity component in x direction</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>land_ice_surface_x_velocity</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[  36.,   23.,    9., ...,   nan,   nan,   nan],
        [  36.,   32.,   46., ...,   nan,   nan,   nan],
        [  41.,   36.,   55., ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[ -19.,   47.,   95., ...,  -15.,  -15.,  -13.],
        [ -11.,   nan,   86., ...,   33.,   52.,   82.],
        [  -5.,   nan,   nan, ...,  -10.,   -3.,  -17.],
        ...,
...
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[   0.,    0.,    0., ...,   nan,   nan,   nan],
        [   2.,    3.,    2., ...,   -1.,   -3.,   -4.],
        [   3.,    4.,    3., ...,    0.,   -2.,   -4.],
        ...,
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]],

       [[  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan],
        ...,
        [  nan,   nan,   nan, ..., -282., -239., -227.],
        [  nan,   nan,   nan, ..., -287., -245., -232.],
        [  nan,   nan,   nan, ...,   nan,   nan,   nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>v_error</span></div><div class="xr-var-dims">(mid_date, y, x)</div><div class="xr-var-dtype">float32</div><div class="xr-var-preview xr-preview">26.0 26.0 26.0 25.0 ... nan nan nan</div><input id="attrs-c29c202c-1acb-455f-9053-b957852cf09f" class="xr-var-attrs-in" type="checkbox"><label for="attrs-c29c202c-1acb-455f-9053-b957852cf09f" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-50e603e6-f440-4891-826a-96443076dde5" class="xr-var-data-in" type="checkbox"><label for="data-50e603e6-f440-4891-826a-96443076dde5" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>velocity magnitude error</dd><dt><span>grid_mapping :</span></dt><dd>mapping</dd><dt><span>standard_name :</span></dt><dd>velocity_error</dd><dt><span>units :</span></dt><dd>meter/year</dd></dl></div><div class="xr-var-data"><pre>array([[[26., 26., 26., ..., nan, nan, nan],
        [26., 26., 26., ..., nan, nan, nan],
        [26., 26., 26., ..., nan, nan, nan],
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]],

       [[nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]],

       [[56., 57., 57., ..., 57., 57., 57.],
        [56., nan, 57., ..., 56., 56., 56.],
        [56., nan, nan, ..., 57., 56., 57.],
        ...,
...
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]],

       [[ 9.,  9.,  9., ..., nan, nan, nan],
        [ 9.,  9.,  9., ...,  9.,  9.,  9.],
        [ 9.,  9.,  9., ...,  9.,  9.,  9.],
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]],

       [[nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        ...,
        [nan, nan, nan, ..., 73., 80., 85.],
        [nan, nan, nan, ..., 73., 75., 79.],
        [nan, nan, nan, ..., nan, nan, nan]]], dtype=float32)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>satellite_img1</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">object</div><div class="xr-var-preview xr-preview">'2A' '2A' '1A' '2A' ... '8' '8' '8'</div><input id="attrs-252cd3c6-20e1-41ea-9bef-bdf1539a1a16" class="xr-var-attrs-in" type="checkbox"><label for="attrs-252cd3c6-20e1-41ea-9bef-bdf1539a1a16" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-8bf92958-a2c4-4bc1-889e-2174164370e7" class="xr-var-data-in" type="checkbox"><label for="data-8bf92958-a2c4-4bc1-889e-2174164370e7" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>id of the satellite that acquired image 1</dd><dt><span>standard_name :</span></dt><dd>image1_satellite</dd></dl></div><div class="xr-var-data"><pre>array(['2A', '2A', '1A', ..., '8', '8', '8'], dtype=object)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>satellite_img2</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">object</div><div class="xr-var-preview xr-preview">'2A' '2A' '1A' '2B' ... '7' '9' '8'</div><input id="attrs-b520739d-acc5-413c-b403-88ad2620bacc" class="xr-var-attrs-in" type="checkbox"><label for="attrs-b520739d-acc5-413c-b403-88ad2620bacc" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-94a6a842-0cba-4d2a-b2a7-f20f4e4464a4" class="xr-var-data-in" type="checkbox"><label for="data-94a6a842-0cba-4d2a-b2a7-f20f4e4464a4" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"><dt><span>description :</span></dt><dd>id of the satellite that acquired image 2</dd><dt><span>standard_name :</span></dt><dd>image2_satellite</dd></dl></div><div class="xr-var-data"><pre>array(['2A', '2A', '1A', ..., '7', '9', '8'], dtype=object)</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>acquisition_date_img1</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2020-01-01T14:27:30.999999744 .....</div><input id="attrs-865e181d-2b7c-4122-8b05-9dd93e454c5d" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-865e181d-2b7c-4122-8b05-9dd93e454c5d" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-718b4201-4f4d-4c24-b50b-c6f9cb3ba65a" class="xr-var-data-in" type="checkbox"><label for="data-718b4201-4f4d-4c24-b50b-c6f9cb3ba65a" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array(['2020-01-01T14:27:30.999999744', '2020-04-30T14:27:30.999999744',
       '2022-10-20T23:57:28.283366144', ...,
       '2017-12-12T14:32:02.832621056', '2020-12-04T14:32:14.522720000',
       '2017-03-08T14:25:29.875194112'], dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>acquisition_date_img2</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">datetime64[ns]</div><div class="xr-var-preview xr-preview">2020-02-20T14:26:51 ... 2017-03-...</div><input id="attrs-a34110e6-6105-472b-a2ac-bc5df8cea600" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-a34110e6-6105-472b-a2ac-bc5df8cea600" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-098da46c-3690-4354-a0ce-7091e89feaa6" class="xr-var-data-in" type="checkbox"><label for="data-098da46c-3690-4354-a0ce-7091e89feaa6" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array(['2020-02-20T14:26:51.000000000', '2021-01-15T14:27:30.999999744',
       '2022-11-01T23:57:28.131517184', ...,
       '2018-02-22T14:33:19.864871936', '2022-05-24T14:31:23.803738880',
       '2017-03-24T14:25:19.651376128'], dtype='datetime64[ns]')</pre></div></li><li class="xr-var-item"><div class="xr-var-name"><span>img_separation</span></div><div class="xr-var-dims">(mid_date)</div><div class="xr-var-dtype">float64</div><div class="xr-var-preview xr-preview">50.0 260.0 12.0 ... 73.0 536.0 16.0</div><input id="attrs-877b5c69-2192-4f42-a561-08756e83a30e" class="xr-var-attrs-in" type="checkbox" disabled=""><label for="attrs-877b5c69-2192-4f42-a561-08756e83a30e" title="Show/Hide attributes"><svg class="icon xr-icon-file-text2"><use href="#icon-file-text2"></use></svg></label><input id="data-f7b8e220-5ab7-4d17-8039-391b833d5c02" class="xr-var-data-in" type="checkbox"><label for="data-f7b8e220-5ab7-4d17-8039-391b833d5c02" title="Show/Hide data repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-var-attrs"><dl class="xr-attrs"></dl></div><div class="xr-var-data"><pre>array([ 50., 260.,  12., ...,  73., 536.,  16.])</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-4335e0c7-4591-4e16-b101-03b64e28dcbf" class="xr-section-summary-in" type="checkbox"><label for="section-4335e0c7-4591-4e16-b101-03b64e28dcbf" class="xr-section-summary">Indexes: <span>(3)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><ul class="xr-var-list"><li class="xr-var-item"><div class="xr-index-name"><div>mid_date</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-6cf490db-6f42-410d-aacd-990669e54807" class="xr-index-data-in" type="checkbox"><label for="index-6cf490db-6f42-410d-aacd-990669e54807" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(DatetimeIndex(['2020-01-26 14:27:11.200101376',
               '2020-09-07 14:27:31.200430080',
               '2022-10-26 23:57:28.428462080',
               '2019-12-05 02:27:10.191013120',
               '2020-05-07 09:51:27.987412736',
               '2020-09-30 02:27:25.200209920',
               '2017-09-01 02:27:45.170615296',
               '2021-04-08 02:27:30.210130176',
               '2020-07-22 02:27:30.191023104',
               '2005-05-30 02:16:11.279971072',
               ...
               '2014-07-14 14:26:04.238845952',
               '2021-08-05 14:32:01.909836032',
               '2021-08-01 14:31:56.227843072',
               '2021-09-02 14:32:04.156598016',
               '2018-07-20 14:30:10.971715840',
               '2013-04-22 02:27:48.904816896',
               '2018-08-05 14:32:31.694700032',
               '2018-01-17 14:32:41.519959040',
               '2021-08-29 14:31:49.364434176',
               '2017-03-16 14:25:24.933592832'],
              dtype='datetime64[ns]', name='mid_date', length=3906, freq=None))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>x</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-611070ea-b3e8-4238-b46d-3472f487a1a3" class="xr-index-data-in" type="checkbox"><label for="index-611070ea-b3e8-4238-b46d-3472f487a1a3" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Float64Index([601732.5, 601852.5, 601972.5, 602092.5, 602212.5, 602332.5,
              602452.5, 602572.5, 602692.5, 602812.5, 602932.5, 603052.5,
              603172.5, 603292.5, 603412.5, 603532.5, 603652.5, 603772.5,
              603892.5, 604012.5, 604132.5, 604252.5, 604372.5, 604492.5,
              604612.5, 604732.5, 604852.5, 604972.5, 605092.5, 605212.5,
              605332.5, 605452.5, 605572.5, 605692.5, 605812.5, 605932.5,
              606052.5, 606172.5, 606292.5, 606412.5, 606532.5, 606652.5,
              606772.5, 606892.5, 607012.5, 607132.5, 607252.5, 607372.5,
              607492.5, 607612.5, 607732.5, 607852.5, 607972.5, 608092.5,
              608212.5, 608332.5, 608452.5, 608572.5, 608692.5, 608812.5,
              608932.5, 609052.5, 609172.5, 609292.5, 609412.5, 609532.5,
              609652.5, 609772.5, 609892.5, 610012.5, 610132.5, 610252.5,
              610372.5, 610492.5, 610612.5, 610732.5, 610852.5, 610972.5,
              611092.5, 611212.5, 611332.5, 611452.5, 611572.5],
             dtype='float64', name='x'))</pre></div></li><li class="xr-var-item"><div class="xr-index-name"><div>y</div></div><div class="xr-index-preview">PandasIndex</div><div></div><input id="index-942da6d9-2d36-4977-aa96-fb0a5630c2dd" class="xr-index-data-in" type="checkbox"><label for="index-942da6d9-2d36-4977-aa96-fb0a5630c2dd" title="Show/Hide index repr"><svg class="icon xr-icon-database"><use href="#icon-database"></use></svg></label><div class="xr-index-data"><pre>PandasIndex(Float64Index([4633267.5, 4633147.5, 4633027.5, 4632907.5, 4632787.5, 4632667.5,
              4632547.5, 4632427.5, 4632307.5, 4632187.5, 4632067.5, 4631947.5,
              4631827.5, 4631707.5, 4631587.5, 4631467.5, 4631347.5, 4631227.5,
              4631107.5, 4630987.5, 4630867.5, 4630747.5, 4630627.5, 4630507.5,
              4630387.5, 4630267.5, 4630147.5, 4630027.5, 4629907.5, 4629787.5,
              4629667.5, 4629547.5, 4629427.5, 4629307.5, 4629187.5, 4629067.5,
              4628947.5, 4628827.5, 4628707.5, 4628587.5, 4628467.5, 4628347.5,
              4628227.5, 4628107.5, 4627987.5, 4627867.5, 4627747.5, 4627627.5,
              4627507.5, 4627387.5, 4627267.5, 4627147.5, 4627027.5, 4626907.5,
              4626787.5, 4626667.5, 4626547.5, 4626427.5, 4626307.5, 4626187.5,
              4626067.5, 4625947.5, 4625827.5, 4625707.5, 4625587.5, 4625467.5,
              4625347.5, 4625227.5, 4625107.5, 4624987.5, 4624867.5, 4624747.5,
              4624627.5, 4624507.5, 4624387.5, 4624267.5, 4624147.5, 4624027.5,
              4623907.5, 4623787.5, 4623667.5, 4623547.5, 4623427.5],
             dtype='float64', name='y'))</pre></div></li></ul></div></li><li class="xr-section-item"><input id="section-a63441d0-b256-4f23-8afd-053971f7a921" class="xr-section-summary-in" type="checkbox"><label for="section-a63441d0-b256-4f23-8afd-053971f7a921" class="xr-section-summary">Attributes: <span>(19)</span></label><div class="xr-section-inline-details"></div><div class="xr-section-details"><dl class="xr-attrs"><dt><span>Conventions :</span></dt><dd>CF-1.8</dd><dt><span>GDAL_AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>author :</span></dt><dd>ITS_LIVE, a NASA MEaSUREs project (its-live.jpl.nasa.gov)</dd><dt><span>autoRIFT_parameter_file :</span></dt><dd>http://its-live-data.s3.amazonaws.com/autorift_parameters/v001/autorift_landice_0120m.shp</dd><dt><span>datacube_software_version :</span></dt><dd>1.0</dd><dt><span>date_created :</span></dt><dd>25-Sep-2023 21:36:13</dd><dt><span>date_updated :</span></dt><dd>25-Sep-2023 21:36:13</dd><dt><span>geo_polygon :</span></dt><dd>[[-73.63972075372371, -48.744984111223324], [-73.29979166239863, -48.740469136708676], [-72.95995631265599, -48.73495208332654], [-72.62023338098132, -48.72843369950857], [-72.28064150478471, -48.72091486899348], [-72.29268612706348, -48.496261573233944], [-72.30458343484656, -48.27159724798241], [-72.3163357191524, -48.0469219210457], [-72.32794522181275, -47.82223562000618], [-72.661644027534, -47.82952223181974], [-72.99546594313978, -47.835839242305354], [-73.32939345769323, -47.84118581784196], [-73.66340902514771, -47.84556125246546], [-73.657595464834, -48.07043103920949], [-73.65171032103902, -48.29529144502879], [-73.64575246763346, -48.5201424691683], [-73.63972075372371, -48.744984111223324]]</dd><dt><span>institution :</span></dt><dd>NASA Jet Propulsion Laboratory (JPL), California Institute of Technology</dd><dt><span>latitude :</span></dt><dd>-48.29</dd><dt><span>longitude :</span></dt><dd>-72.98</dd><dt><span>proj_polygon :</span></dt><dd>[[600000, 4600000], [625000.0, 4600000.0], [650000.0, 4600000.0], [675000.0, 4600000.0], [700000, 4600000], [700000.0, 4625000.0], [700000.0, 4650000.0], [700000.0, 4675000.0], [700000, 4700000], [675000.0, 4700000.0], [650000.0, 4700000.0], [625000.0, 4700000.0], [600000, 4700000], [600000.0, 4675000.0], [600000.0, 4650000.0], [600000.0, 4625000.0], [600000, 4600000]]</dd><dt><span>projection :</span></dt><dd>32718</dd><dt><span>s3 :</span></dt><dd>s3://its-live-data/datacubes/v2/S40W070/ITS_LIVE_vel_EPSG32718_G0120_X650000_Y4650000.zarr</dd><dt><span>skipped_granules :</span></dt><dd>s3://its-live-data/datacubes/v2/S40W070/ITS_LIVE_vel_EPSG32718_G0120_X650000_Y4650000.json</dd><dt><span>time_standard_img1 :</span></dt><dd>UTC</dd><dt><span>time_standard_img2 :</span></dt><dd>UTC</dd><dt><span>title :</span></dt><dd>ITS_LIVE datacube of image pair velocities</dd><dt><span>url :</span></dt><dd>https://its-live-data.s3.amazonaws.com/datacubes/v2/S40W070/ITS_LIVE_vel_EPSG32718_G0120_X650000_Y4650000.zarr</dd></dl></div></li></ul></div></div>
</div>
</div>
</section>
<section id="glacier_centerline" class="level3">
<h3 class="anchored" data-anchor-id="glacier_centerline"><a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_centerline"><code>Glacier_Centerline</code></a></h3>
<p>Similarly to the <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_point"><code>Glacier_Point</code></a> object, a <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_centerline"><code>Glacier_Centerline</code></a> object inherits some basic information from a <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier"><code>Glacier</code></a> object, but this can also be specified manually if you don’t want to create a <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier"><code>Glacier</code></a> method beforehand. A <a href="https://e-marshall.github.io/ITS_LIVE_TOOL/obj_setup.html#glacier_centerline"><code>Glacier_Centerline</code></a> object has attributes called <code>centerlines</code> and <code>main_centerline</code>. These are both <code>Geopandas.GeoDataframe</code> objects containing OGGM flowline data associated with this glacier. They also contain ITS_LIVE image pair velocity time series clipped to the centerline (<strong>still being implemented</strong>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>glacier_centerline <span class="op">=</span> obj_setup.Glacier_Centerline(<span class="st">'Jorge Montt'</span>, <span class="st">'RGI60-17.06074'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>glacier_centerline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;ITS_LIVE_TOOL.obj_setup.Glacier_Centerline&gt;</code></pre>
</div>
</div>
<p>Each of these objects are meant to act as cotainers to intuitively and efficiently store different types of data as you process and continue to work with ITS_LIVE data.</p>
<p>The previous steps demonstrated the data access and organization functionality of ITS_LIVE_TOOl. The subsequent sections of this notebook will demonstrate different processing methodologies for working with this dataset.</p>
</section>
</section>
<section id="section-2-data-processing" class="level1">
<h1>Section 2: Data Processing</h1>
<section id="gaussian-process-regression-1" class="level2">
<h2 class="anchored" data-anchor-id="gaussian-process-regression-1">Gaussian Process Regression</h2>
<p>We demonstrate a method to develop and apply a Gaussian Process model on ITS_LIVE point time series data. Gaussian Process are a non-parametric, Bayesion regression method to model a latent function such as glacier surface velocity with respect to time, given observations of ice movement over different time periods.</p>
<pre class="{note}"><code>This method is in active development and should currently be considered to be in 'beta' mode. We provide an example of its implementation but stress that it may not be suitable to apply in other scenarios. Please carefully inspect your dataset and the model parameters to be sure it is appropriate before using in your workflows</code></pre>
<section id="problem" class="level3">
<h3 class="anchored" data-anchor-id="problem">Problem:</h3>
<p>ITS_LIVE image pair ice velocity time series provide estimates of ice movement over a broad range of temporal baselines (number of days between image pairs). The estimates describe different types of ice movement given different temporal baselines and contain noise inherent to sensor algorithmic limitations. Given this complex, noisy dataset, we would like to employ a regression approach to reach an estimate of an underlying velocity function with inherent uncertainty quantifications.</p>
</section>
<section id="raw-data" class="level3">
<h3 class="anchored" data-anchor-id="raw-data">Raw data</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/e-marshall/ITS_LIVE_TOOL/blob/main/figs/baltoro_raw_data_example.png?raw=true" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">ITS_LIVE velocity observations for a single point</figcaption>
</figure>
</div>
</section>
<section id="gaussian-process-model-predictions" class="level3">
<h3 class="anchored" data-anchor-id="gaussian-process-model-predictions">Gaussian Process model predictions</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/e-marshall/ITS_LIVE_TOOL/blob/main/figs/baltoro_gp_example_results.png?raw=true" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Velocity time series predicted by Gaussian Process model based on ITS_LIVE velocity observations</figcaption>
</figure>
</div>
<pre class="{note}"><code>Put inversion and other processing steps here? </code></pre>
</section>
</section>
</section>
<section id="datacube-inversion" class="level1">
<h1>Datacube Inversion</h1>
</section>
<section id="theory-of-velocity-interpolation-for-a-single-point-time-series" class="level1">
<h1>Theory of velocity interpolation for a single point time series</h1>
<p><br> <br></p>
<section id="problem-1" class="level4">
<h4 class="anchored" data-anchor-id="problem-1"><strong>Problem:</strong></h4>
<p><em>Find a smooth regularly spaced timeseries of velocities given a set of average measurements of possibly overlapping and variable length time intervals</em></p>
<p><br> <br></p>
</section>
<section id="start-we-formulate-it-as-an-inverse-problem" class="level4">
<h4 class="anchored" data-anchor-id="start-we-formulate-it-as-an-inverse-problem"><strong>Start: we formulate it as an inverse problem</strong></h4>
<p><em>Find a velocity vector <span class="math inline">\(\mathbf{v}\)</span> that minimizes the following functional:</em></p>
<p><br></p>
<p><span class="math inline">\(U(\mathbf{v},\lambda) = \|\mathbf{vInv}\|_r + \lambda \|A_{m}\mathbf{vInv} - \mathbf{vObs}\|\)</span></p>
<p><br></p>
<ul>
<li><p><span class="math inline">\(\mathbf{vObs}\)</span>: velocity measurements</p></li>
<li><p><span class="math inline">\(\mathbf{vInv}\)</span>: vector of speeds that we are solving for at a regular interval (for example daily)</p></li>
<li><p><span class="math inline">\(\|.\|_r\)</span>: is a roughness norm or a measure of the first derivative</p></li>
<li><p><span class="math inline">\(\lambda\)</span>: can be seen as a Lagrange multiplier (it enforces the condition in the expression behind it), or one can think of it as a relative weight of how well we want it to fit the data versus how smooth the resulting interpolated velocity should be.</p></li>
<li><p><span class="math inline">\(\mathbf{A_{m}}\)</span>: indexing matrix that specifies over which time interval a velocity was measured (and averages it appropriately).</p></li>
</ul>
<p><br></p>
</section>
<section id="design-matrix-part-1-date-span-matrix" class="level4">
<h4 class="anchored" data-anchor-id="design-matrix-part-1-date-span-matrix"><strong>Design Matrix part 1: Date Span Matrix</strong></h4>
<p>For a simple example, assume you want daily velocities for 6 days, and you have a measurement of the average velocity from day 1 to day 4 (<span class="math inline">\(d_1\)</span>) and from day 3 to day 5 (<span class="math inline">\(d_2\)</span>). We then have:</p>
<p><span class="math display">\[A_{m} = \begin{bmatrix}
        1/4 &amp; 1/4 &amp; 1/4 &amp; 1/4 &amp; 0 &amp; 0 \\
        0 &amp; 0 &amp; 1/3 &amp; 1/3 &amp; 1/3 &amp; 0
        \end{bmatrix}\]</span></p>
<p><br></p>
<p><strong>Dimensions:</strong> The number of rows is equal to the number of measurements <span class="math inline">\(N\)</span> (same dimension as <span class="math inline">\(\mathbf{vObs}\)</span>) and the number of columns <span class="math inline">\(M\)</span> (same dimension as <span class="math inline">\(\mathbf{vInv}\)</span>).</p>
<p><br></p>
</section>
<section id="design-matrix-part-2-regularization-matrix" class="level4">
<h4 class="anchored" data-anchor-id="design-matrix-part-2-regularization-matrix"><strong>Design Matrix part 2: Regularization Matrix</strong></h4>
<p>In order to regularize the matrix in time, we create a matrix of regularization <span class="math inline">\(\mathbf{reg_{mat}}\)</span> which dimensions are <span class="math inline">\((M-D)\)</span> x <span class="math inline">\(M\)</span> (D is the degree of the derivative used for the regularization), for which each entry will be depending on the <span class="math inline">\(\lambda\)</span>&nbsp;term and the order of the term we apply the regularization to (approximation of finite differences).</p>
<p><strong>1st derivative regularization:</strong> <span class="math inline">\(f'(x) \approx \frac{f_{i+1} - f_{i}}{h}\)</span> Matrix size: <span class="math inline">\((M-1)\)</span> x <span class="math inline">\(M\)</span></p>
<p>Which would result in: <span class="math display">\[reg_{mat} = \begin{bmatrix}
                                        -\frac{\lambda}{h} &amp; \frac{\lambda}{h} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; -\frac{\lambda}{h} &amp; \frac{\lambda}{h}&amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; \frac{\lambda}{h} &amp; \frac{\lambda}{h}&amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; -\frac{\lambda}{h} &amp; \frac{\lambda}{h}&amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; -\frac{\lambda}{h} &amp; \frac{\lambda}{h} \\
                                        \end{bmatrix}\]</span></p>
<p><br></p>
<p><strong>2nd derivative regularization:</strong> <span class="math inline">\(f''(x) \approx \frac{f_{i+2} - 2f_{i+1} + f_{i}}{h}\)</span> Matrix size: <span class="math inline">\((M-2)\)</span> x <span class="math inline">\(M\)</span></p>
<p>Which would result in: <span class="math display">\[reg_{mat} = \begin{bmatrix}
                                        \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} \\
                                        \end{bmatrix}\]</span></p>
<p><br></p>
</section>
<section id="design-matrix-part-3-assemble-the-design-matrix" class="level4">
<h4 class="anchored" data-anchor-id="design-matrix-part-3-assemble-the-design-matrix"><strong>Design Matrix part 3: Assemble the Design Matrix</strong></h4>
<p>And we finally obtain our main design matrix (with 2nd derivative), which is a concatenation of <span class="math inline">\(A_{m}\)</span>&nbsp;and <span class="math inline">\(reg_{mat}\)</span>:</p>
<p><span class="math display">\[A_{reg} = \begin{bmatrix}             \\ &amp; &amp; A_{m} &amp; &amp; &amp; \\ \\
                                        \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} \\
                                        \end{bmatrix}\]</span></p>
<p><br></p>
</section>
<section id="extend-the-vector-of-observations" class="level4">
<h4 class="anchored" data-anchor-id="extend-the-vector-of-observations"><strong>Extend the vector of observations</strong></h4>
<p>Because we added a regularization matrix to our design matrix, we need to extend our vector of observations <span class="math inline">\(\mathbf{vObs}\)</span> so we can calculate the inversion:</p>
<p><span class="math display">\[\begin{bmatrix} v_{0} \\ v_{1} \\ ... \\ v_{n} \end{bmatrix} to \begin{bmatrix} v_{0} \\ v_{1} \\ ... \\ v_{n} \\ 0 \\ 0 \\ ... \\ 0 \end{bmatrix} \]</span></p>
<p>With the amount of 0s appended being <span class="math inline">\((M-1)\)</span></p>
<p>The obtained velocity vector is then the size of the regular matrix in time. (We can add a spatial regularization but it increases the computation time by 3.)</p>
<p><br></p>
</section>
<section id="final-part-solve-the-linear-system-of-equations" class="level4">
<h4 class="anchored" data-anchor-id="final-part-solve-the-linear-system-of-equations"><strong>Final Part: Solve the Linear System of Equations</strong></h4>
<p><span class="math inline">\(A_{reg}^{T}A_{reg}\mathbf{vInv}= A_{reg}^{T}\mathbf{vObs}\)</span></p>
<p><br></p>
<p>Using a linear solver (<code>np.linalg.solve()</code>, <code>scipy.linalg.solve()</code>, <code>torch.linalg.solve()</code>) find <span class="math inline">\(\mathbf{vInv}\)</span> satisfying the equation, which is equivalent to solving: <span class="math inline">\(U(\mathbf{v},\lambda) = \|\mathbf{vInv}\|_r + \lambda \|A_{m}\mathbf{vInv} - \mathbf{vObs}\|\)</span>.</p>
<p>We can use a linear solver because the matrix <span class="math inline">\(A_{reg}^{T}A_{reg}\)</span> is square, symmetrical positive.</p>
<p><br> <br></p>
</section>
</section>
<section id="inversion-applied-to-its_live" class="level1">
<h1>Inversion applied to ITS_LIVE</h1>
<section id="its_live-primary-issue" class="level4">
<h4 class="anchored" data-anchor-id="its_live-primary-issue"><strong>ITS_LIVE primary issue:</strong></h4>
<p>ITS_LIVE is a great dataset that achieves high-density measurements globally, on a long timescale, using the same sensors and method. However it suffers from one main problem: <strong>mid_dates</strong>, its attribution of a timestamp for a measurement.</p>
<p><br></p>
<p><strong>Example 1:</strong> ITS_LIVE uses two images to calculate the velocity of the ice. 1st image is acquired on <em>January 1st</em>, 2nd image is acquired on <em>January 15th</em>.</p>
<p>We obtain an average velocity over 15 days: <span class="math inline">\(v = \frac{displacement}{15 days} = 10 m/day\)</span></p>
<p>The problem is that ITS_LIVE will attribute this velocity to a <strong>precise point in time</strong> rather than a <strong>period of time</strong>: the velocity of <span class="math inline">\(10 m/day\)</span> is attributed to <em>January 7th</em> at Noon. This is physically wrong.</p>
<p>It is difficult to work with periods of time, while precise points in time are much more convenient, which is probably why ITS_LIVE organizes its data like that.</p>
<p><br></p>
<p><strong>Example 2:</strong> We now have 2 measurements of velocities: - <strong>V1</strong>: <span class="math inline">\(10 m/day\)</span>, timestamp: <em>January 7th</em>, Date 1st image acquisition: <em>January 1st</em>, Date 2nd image acquisition: <em>January 15th</em><br>
- <strong>V2</strong>: <span class="math inline">\(5 m/day\)</span>, timestamp: <em>January 12th</em>, Date 1st image acquisition: <em>January 5th</em>, Date 2nd image acquisition: <em>January 19th</em></p>
<p>ITS_LIVE would put only 2 timestamps. However there is more information than just during those two days. The intersection between the two measurements procures information on the average velocity between <em>January 5th</em> and <em>January 15th</em>. Because we now have a fragmentation of each acquisition into smaller segments, we can also derive refined average velocities for the following periods of time: - <em>January 1st</em> and <em>January 5th</em> - <em>January 5th</em> and <em>January 7th</em> - <em>January 7th</em> and <em>January 12th</em> - <em>January 12th</em> and <em>January 15th</em> - <em>January 15th</em> and <em>January 19th</em></p>
<p><br></p>
</section>
<section id="inversion-theory-applied-to-its_live" class="level4">
<h4 class="anchored" data-anchor-id="inversion-theory-applied-to-its_live"><strong>Inversion theory applied to ITS_LIVE:</strong></h4>
<p>Let’s consider the same setup at in <strong>Example 2</strong>. We want to linearize in time to force a sampling of velocities 2 days. Thus, our matrix <span class="math inline">\(A_{m}\)</span> will have 2 rows (we have 2 average velocities given by ITS_LIVE), and 10 columns (19 days between the first and last acquisition dates: <em>January 1st</em> and <em>January 19th</em>, divided by 2 because we force 2 days sampling):</p>
<p><span class="math display">\[dates = \begin{bmatrix}
        1st &amp; 3rd &amp; 5th &amp; 7th &amp; 9th &amp; 11th &amp; 13th &amp; 15th &amp; 17th &amp; 19th
        \end{bmatrix}\]</span></p>
<p><span class="math display">\[A_{m} = \begin{bmatrix}
        1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 0    &amp;    0   \\
        0    &amp;    0 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14
        \end{bmatrix}\]</span> <br></p>
<p>In the matrix above, each column is paired with a date (matrix ’dates). The first row of <span class="math inline">\(A_{m}\)</span> corresponds to the first velocity measurement. Because this measurement is the average velocity from <em>January 1st</em> to <em>January 15th</em>, every day in between has <em>1/15</em> attributed to it in the matrix (15 days, each contributing equally to the velocity observed). The 2nd row, representing the 2nd velocity measurement (or observed) spans 14 days hence why the values there are <em>1/14</em>. Note that when a day is not covered by the velocity time period, the value is 0.</p>
<p><br></p>
<p><strong>Assemble the design matrix:</strong> (regularization in time with 2nd derivative, Jacobian):</p>
<p><span class="math display">\[A_{reg} = \begin{bmatrix}             1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 0    &amp;    0  \\
                                        0    &amp;    0 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14  \\
                                        \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}}\\
                                        \end{bmatrix}\]</span></p>
<p><br></p>
<p><strong>Extend the vector <span class="math inline">\(\mathbf{vObs}\)</span>:</strong></p>
<p><span class="math display">\[\mathbf{vObs} = \begin{bmatrix} v1 \\ v2 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \end{bmatrix} \]</span></p>
<p><strong>Solve the linear system of equation:</strong></p>
$$
<span class="math display">\[\begin{bmatrix}                       1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 1/15 &amp; 0    &amp;    0  \\
                                        0    &amp;    0 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14 &amp; 1/14  \\
                                        \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 \\
                                        0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}}\\
                                        \end{bmatrix}\]</span>
<pre><code>                                    \begin{bmatrix}             
                                    1/15 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
                                    1/15 &amp; 0 &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
                                    1/15 &amp; 1/14 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                    1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 \\
                                    1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 \\
                                    1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 \\
                                    1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}}  &amp; 0\\
                                    1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}}\\
                                    0    &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; 2\frac{\lambda}{h^{2}}\\
                                    0    &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}}\\ 

                                    \end{bmatrix}\mathbf{vInv}$$
                                    </code></pre>
<span class="math display">\[ = \]</span> $$
<span class="math display">\[\begin{bmatrix}             
                                        1/15 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
                                        1/15 &amp; 0 &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
                                        1/15 &amp; 1/14 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
                                        1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 &amp; 0 \\
                                        1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 &amp; 0 \\
                                        1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}} &amp; 0 \\
                                        1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}}  &amp; 0\\
                                        1/15 &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; -2\frac{\lambda}{h^{2}} &amp; \frac{\lambda}{h^{2}}\\
                                        0    &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}} &amp; 2\frac{\lambda}{h^{2}}\\
                                        0    &amp; 1/14 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\lambda}{h^{2}}\\

                                        \end{bmatrix}\begin{bmatrix} v1 \\ v2 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \\ 0 \end{bmatrix}\]</span>
<p>$$</p>
<p><strong>You end up with <span class="math inline">\(\mathbf{vInv}\)</span></strong></p>
<p><br></p>
</section>
</section>
<section id="input-your-parameters-below" class="level1">
<h1>Input your parameters below</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>mission <span class="op">=</span> <span class="va">None</span> <span class="co"># 'None' if you want all the data, 'S1' for Sentinel-1 only, 'L' for Landsat only, etc.. .</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>lamb <span class="op">=</span> <span class="dv">10</span> <span class="co"># Smoothing coefficient: the higher the value, the more the inversion favors a smooth output. BAD for surging glaciers, GOOD for non-surging glaciers.</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>derivative <span class="op">=</span> <span class="dv">2</span> <span class="co"># Derivative degree for the inversion. Doesn't change much unless you have a specific reasong to choose 1 or 2 (1st or 2nd derivative, Hessian of Jacobian)</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>day_interval <span class="op">=</span> <span class="dv">12</span> <span class="co"># Amount of days in between each inversion value. The higher, the faster the inversion. But you also lose in temporal resolution. 12 here because Sentinel-1 repeat-time is 12.</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>sdate <span class="op">=</span> <span class="va">None</span> <span class="co"># Start date, format 'YYYY-MM-DD' OR None if you want to grab the entire timeseries available</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>edate <span class="op">=</span> <span class="va">None</span> <span class="co"># End date, format 'YYYY-MM-DD' OR None if you want to grab the entire timeseries available</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>GPU <span class="op">=</span> <span class="va">True</span> <span class="co"># None if you want to run it on CPU</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="select-your-data" class="level2">
<h2 class="anchored" data-anchor-id="select-your-data">Select your data</h2>
<section id="instructions" class="level4">
<h4 class="anchored" data-anchor-id="instructions"><strong>Instructions:</strong></h4>
<ul>
<li><p>Right-click on a glacier to get its RGI ID. It should illuminate in blue once you have selected it. You can select multiple glaciers.</p>
<p><strong>WARNING:</strong> if you are on a web browser (Cryocloud, OpenScienceLab, etc…): right-click will open a pop-up menu. Simply left-click somewhere on your screen to make it disappear.</p></li>
<li><p>Left-click on the datacube (<em>grey</em> overlay, <em>red</em> when you hover your mouse over it) you want to download. You can select multiple datacubes. When a datacube URL has been fetched, it should print it below the GUI.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data_map <span class="op">=</span> interactive.Widget()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>data_map.display()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"12cb29740ef14fbe8051906d7f8226f9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    coords, gpdf, urls <span class="op">=</span> interactive.return_clicked_info(data_map)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">##### EMMA IN NOTEBOOK 2 ADD 'GeoData' to the import line: from ipyleaflet import Map, WMSLayer, basemaps, GeoData</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> []</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>wms_url <span class="op">=</span> <span class="st">"https://glims.org/geoserver/ows?SERVICE=WMS&amp;"</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>wms_layer <span class="op">=</span> WMSLayer(</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    url<span class="op">=</span>wms_url,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    layers<span class="op">=</span><span class="st">'GLIMS:RGI'</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    transparent<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">'image/png'</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Pandas DataFrame with X and Y coordinates</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co">#data = pd.DataFrame({'X': list(fx_map[::50]), 'Y': list(fy_map[::50])})</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Map and label widgets</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="bu">map</span> <span class="op">=</span> ipyl.Map(basemap<span class="op">=</span>basemaps.Esri.WorldImagery, center<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">0</span>), zoom<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>label <span class="op">=</span> ipyw.Label(layout<span class="op">=</span>ipyw.Layout(width<span class="op">=</span><span class="st">"100%"</span>))</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store clicked URLs</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> []</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="co"># geojson layer with hover handler</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"catalog_v02.json"</span>) <span class="im">as</span> f:</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    geojson_data <span class="op">=</span> json.load(f)</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feature <span class="kw">in</span> geojson_data[<span class="st">"features"</span>]:</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    feature[<span class="st">"properties"</span>][<span class="st">"style"</span>] <span class="op">=</span> {</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"grey"</span>,</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"weight"</span>: <span class="dv">1</span>,</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fillColor"</span>: <span class="st">"grey"</span>,</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fillOpacity"</span>: <span class="fl">0.5</span>,</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>geojson_layer <span class="op">=</span> ipyl.GeoJSON(data<span class="op">=</span>geojson_data, hover_style<span class="op">=</span>{<span class="st">"fillColor"</span>: <span class="st">"red"</span>}, selected_style <span class="op">=</span> {<span class="st">"fillColor"</span>: <span class="st">"orange"</span>})</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hover_handler(event<span class="op">=</span><span class="va">None</span>, feature<span class="op">=</span><span class="va">None</span>, <span class="bu">id</span><span class="op">=</span><span class="va">None</span>, properties<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    label.value <span class="op">=</span> properties[<span class="st">"zarr_url"</span>]</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> json_handler(event<span class="op">=</span><span class="va">None</span>, feature<span class="op">=</span><span class="va">None</span>, <span class="bu">id</span><span class="op">=</span><span class="va">None</span>, properties<span class="op">=</span><span class="va">None</span>):    </span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    zarr_url <span class="op">=</span> properties.get(<span class="st">"zarr_url"</span>, <span class="st">"N/A"</span>)</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    urls.append(zarr_url)</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Clicked URL: </span><span class="sc">{</span>zarr_url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"All Clicked URLs:"</span>, urls)</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a><span class="co">    # Plot in orange the polygon clicked on</span></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a><span class="co">    json_shape = [{'type': properties['geometry_epsg']['type'], 'coordinates': properties['geometry_epsg']['coordinates']}]</span></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a><span class="co">    geom = [shape(i) for i in json_shape]</span></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a><span class="co">    json_shape = gpd.GeoDataFrame({'geometry':geom})  </span></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a><span class="co">    json_shape = GeoData(geo_dataframe = json_shape,</span></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a><span class="co">                style={'color': 'black', 'fillColor': '#3366cc', 'opacity':0.05, 'weight':1.9, 'dashArray':'2', 'fillOpacity':0.6},</span></span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a><span class="co">                hover_style={'fillColor': 'blue' , 'fillOpacity': 0.2},</span></span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a><span class="co">                name = 'Cube')</span></span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a><span class="co">    map.add_layer(json_shape)</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>wms <span class="op">=</span> WebMapService(wms_url)</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store the geopandas dataframes</span></span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>gdf_list <span class="op">=</span> []</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to handle click events</span></span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> click_handler(properties<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>kwargs):</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> kwargs.get(<span class="st">'type'</span>) <span class="op">==</span> <span class="st">'contextmenu'</span>:</span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>        latlon <span class="op">=</span> kwargs.get(<span class="st">'coordinates'</span>)</span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>        lat, lon <span class="op">=</span> latlon[<span class="dv">0</span>], latlon[<span class="dv">1</span>]</span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Clicked at (Lat: </span><span class="sc">{</span>lat<span class="sc">}</span><span class="ss">, Lon: </span><span class="sc">{</span>lon<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Arrange the coordinates</span></span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> wms.getfeatureinfo(</span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a>            layers<span class="op">=</span>[<span class="st">'GLIMS:RGI'</span>],</span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>            srs<span class="op">=</span><span class="st">'EPSG:4326'</span>,</span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>            bbox<span class="op">=</span>(lon<span class="op">-</span><span class="fl">0.001</span>,lat<span class="op">-</span><span class="fl">0.001</span>,lon<span class="op">+</span><span class="fl">0.001</span>,lat<span class="op">+</span><span class="fl">0.001</span>),</span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>            size<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a>            <span class="bu">format</span><span class="op">=</span><span class="st">'image/jpeg'</span>,</span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a>            query_layers<span class="op">=</span>[<span class="st">'GLIMS:RGI'</span>],</span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a>            info_format<span class="op">=</span><span class="st">"application/json"</span>,</span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a>            xy<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> gpd.read_file(response)</span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a>        gdf_list.append(df)  </span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"You have selected the glacier </span><span class="sc">{</span>df[<span class="st">'NAME'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, ID: </span><span class="sc">{</span>df[<span class="st">'id'</span>]<span class="sc">.</span>values[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> "</span>)</span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"This glacier is not recognized by the RGI (maybe an ice-shelf ?) -&gt; Choose another one"</span>)</span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a>        geo_data <span class="op">=</span> GeoData(geo_dataframe <span class="op">=</span> df,</span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a>                   style<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'black'</span>, <span class="st">'fillColor'</span>: <span class="st">'#3366cc'</span>, <span class="st">'opacity'</span>:<span class="fl">0.05</span>, <span class="st">'weight'</span>:<span class="fl">1.9</span>, <span class="st">'dashArray'</span>:<span class="st">'2'</span>, <span class="st">'fillOpacity'</span>:<span class="fl">0.6</span>},</span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a>                   hover_style<span class="op">=</span>{<span class="st">'fillColor'</span>: <span class="st">'blue'</span> , <span class="st">'fillOpacity'</span>: <span class="fl">0.2</span>},</span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a>                   name <span class="op">=</span> <span class="st">'Glacier'</span>)</span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a>        gdf_list.append(df) </span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a>        <span class="bu">map</span>.add_layer(geo_data)</span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a>geojson_layer.on_hover(hover_handler)</span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a>geojson_layer.on_click(json_handler)</span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-105"><a href="#cb56-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-106"><a href="#cb56-106" aria-hidden="true" tabindex="-1"></a><span class="bu">map</span>.add(geojson_layer)</span>
<span id="cb56-107"><a href="#cb56-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-108"><a href="#cb56-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Add points from the DataFrame to the map</span></span>
<span id="cb56-109"><a href="#cb56-109" aria-hidden="true" tabindex="-1"></a><span class="co">#for index, row in data.iterrows():</span></span>
<span id="cb56-110"><a href="#cb56-110" aria-hidden="true" tabindex="-1"></a><span class="co">#    marker = ipyl.Marker(locatfairbanks ash situationion=(row['Y'], row['X']))</span></span>
<span id="cb56-111"><a href="#cb56-111" aria-hidden="true" tabindex="-1"></a><span class="co">#    map.add_layer(marker)</span></span>
<span id="cb56-112"><a href="#cb56-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-113"><a href="#cb56-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable zoom when scrolling with the mouse</span></span>
<span id="cb56-114"><a href="#cb56-114" aria-hidden="true" tabindex="-1"></a><span class="bu">map</span>.scroll_wheel_zoom <span class="op">=</span> <span class="va">True</span></span>
<span id="cb56-115"><a href="#cb56-115" aria-hidden="true" tabindex="-1"></a>ipyw.VBox([<span class="bu">map</span>, label])</span>
<span id="cb56-116"><a href="#cb56-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-117"><a href="#cb56-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-118"><a href="#cb56-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the WMS layer to the map</span></span>
<span id="cb56-119"><a href="#cb56-119" aria-hidden="true" tabindex="-1"></a><span class="bu">map</span>.add_layer(wms_layer)</span>
<span id="cb56-120"><a href="#cb56-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-121"><a href="#cb56-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the click event handler to the map</span></span>
<span id="cb56-122"><a href="#cb56-122" aria-hidden="true" tabindex="-1"></a><span class="bu">map</span>.on_interaction(click_handler)</span>
<span id="cb56-123"><a href="#cb56-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-124"><a href="#cb56-124" aria-hidden="true" tabindex="-1"></a><span class="bu">map</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following cell ensures you don’t have duplicate glaciers in your selection. If so, it will automatically remove them. It also verifies that you have selected a datacube to download. If not, please re-select it and ensure you are getting a URL after a left-click.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">### EMMA THIS IS THE CELL TO MODIFY</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get indices of unique geopandas dataframes in case you selected the same glacier twice</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>unique_values, unique_indices <span class="op">=</span> np.unique(np.array([i[<span class="st">'id'</span>] <span class="cf">for</span> i <span class="kw">in</span> gdf_list]), return_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the unique indices to recreate the list of geopandas dataframes unique only</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>gdf_list <span class="op">=</span> [gdf_list[i] <span class="cf">for</span> i <span class="kw">in</span> unique_indices]</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"You have </span><span class="sc">{</span><span class="bu">len</span>(gdf_list)<span class="sc">}</span><span class="ss"> glaciers selected"</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(urls) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Select a datacube to fetch the data !!'</span>)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first dataframe to show the structure of it</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>gdf_list[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just a peek at what the Randolph Glacier Inventory (RGI) gives us for a glacier object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>gpdf[<span class="dv">0</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['http://its-live-data.s3.amazonaws.com/datacubes/v2/N20E080/ITS_LIVE_vel_EPSG32644_G0120_X750000_Y3250000.zarr']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    gpdf_ls <span class="op">=</span> gpdf[<span class="dv">0</span>]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_input_dict(coords, gpdf, urls):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    mod_urls <span class="op">=</span> [re.sub(<span class="vs">r'http'</span>, <span class="st">'s3'</span>, url) <span class="cf">for</span> url <span class="kw">in</span> urls]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    mod_urls <span class="op">=</span> [re.sub(<span class="vs">r'\.s3\.amazonaws\.com'</span>, <span class="st">''</span>, url) <span class="cf">for</span> url <span class="kw">in</span> mod_urls]</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> {<span class="st">'coords'</span>: coords,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">'gpdf'</span>: gpdf,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>     <span class="st">'urls'</span>: mod_urls</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> make_input_dict(coords, gpdf, URLs)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    urls <span class="op">=</span> d[<span class="st">'urls'</span>]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">' no input data specified, have you made a map selection?'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> no input data specified, have you made a map selection?</code></pre>
</div>
</div>
<p>The following function creates a dictionnary for a datacube URL. It prepares the many variables we will use during the cube inversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_data_dict(urls):</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modify the urls so they can be opened by zarr (replace 'http' by 's3' and delete '.s3.amazonaws.com')</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    mod_urls <span class="op">=</span> [re.sub(<span class="vs">r'http'</span>, <span class="st">'s3'</span>, url) <span class="cf">for</span> url <span class="kw">in</span> urls]</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    mod_urls <span class="op">=</span> [re.sub(<span class="vs">r'\.s3\.amazonaws\.com'</span>, <span class="st">''</span>, url) <span class="cf">for</span> url <span class="kw">in</span> urls]</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create storing arrays for the coordinates on-glacier</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    X_valid <span class="op">=</span> []</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    Y_valid <span class="op">=</span> []</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    X_tot <span class="op">=</span> []</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    Y_tot <span class="op">=</span> []</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an empty directoryimport pickle to hold many variables all tied to the datacubes</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    data_dict <span class="op">=</span> {}</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We iterate through the different datacubes so they can each have one instance of the variables below</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> mod_urls <span class="kw">in</span> urls:</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>        zarr_store <span class="op">=</span> <span class="va">None</span> <span class="co"># To store the datacube's information and access its variables</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>        dates <span class="op">=</span> <span class="va">None</span> <span class="co"># To store the dates at which the inversion will give values</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>        A_m <span class="op">=</span> <span class="va">None</span> <span class="co"># 1st part of the design matrix</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>        reg_mat_Inv <span class="op">=</span> <span class="va">None</span> <span class="co"># Regularization in time, 2nd part of the design matrix</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>        mission <span class="op">=</span> <span class="va">None</span> <span class="co"># If you want to invert specifically for one mission in particular ('S1','L8','L9', etc...)</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>        index_sort <span class="op">=</span> <span class="va">None</span> <span class="co"># Indices representing the sorted dates (from older to most recent)</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>        inds_mission <span class="op">=</span> <span class="va">None</span> <span class="co"># Indices representing the sorted dates per mission chosen</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>        ind_tot <span class="op">=</span> <span class="va">None</span> <span class="co"># Indices representing the indices of the pixels on the GOI</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> <span class="va">None</span> <span class="co"># Easting and Northing values of the indices above</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>        proj_cube <span class="op">=</span> <span class="va">None</span> <span class="co"># Projection of the datacube</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>        mask_dates <span class="op">=</span> <span class="va">None</span> <span class="co"># Mask that filters out dates outside of desired date range</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a dictionary entry for the URL with the desired subsets</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>        data_dict[mod_urls] <span class="op">=</span> {</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'zarr_store'</span>: zarr_store,</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'dates_noinv'</span>: dates,</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'A_m'</span>: A_m,</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'reg_mat_Inv'</span>: reg_mat_Inv,</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'mission'</span>: mission,</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'index_sort'</span>: index_sort,</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'inds_mission'</span>: inds_mission,</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'dates'</span>: dates,</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ind_tot'</span>: ind_tot,</span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'valid_idx'</span>: valid_idx,</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'proj_cube'</span>: proj_cube,</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'mask_dates'</span>: mask_dates</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_dict, X_valid, Y_valid, X_tot, Y_tot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function inputs a datacube. It fetches its spatial footprint, and flags which cells that fall on the glacier shape you selected earlier. The purpose is to create an array that gathers the spatial intersection between all the datacubes and glaciers you selected. It also creates a mask so we only download datacube cells on a glacier, and we don’t compute the inversion on non-glacier cells in case some get through the filter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_extents(url, gpdf, X_tot, Y_tot, X_valid, Y_valid, data_dict):<span class="co"># mission, lamb, derivative, day_interval):</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#url = input_data_dict['urls'].iloc[0]</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Open the zarr files</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    fs <span class="op">=</span> s3fs.S3FileSystem(anon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    store <span class="op">=</span> zarr.<span class="bu">open</span>(s3fs.S3Map(url, s3<span class="op">=</span>fs))</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the dictionnary</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    data_dict[url][<span class="st">'zarr_store'</span>] <span class="op">=</span> store</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the cube's projection</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    proj_cube <span class="op">=</span> store.attrs[<span class="st">'projection'</span>]</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load X and Y of the dataset</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> store[<span class="st">'x'</span>][:]</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    Y <span class="op">=</span> store[<span class="st">'y'</span>][:]</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the arrays in the total list</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    X_tot.append(X)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    Y_tot.append(Y)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load dimensions</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    shape_arr <span class="op">=</span> store[<span class="st">'v'</span>].shape</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    Xs, Ys <span class="op">=</span> np.meshgrid(X, Y)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span> np.array((Xs.flatten(), Ys.flatten())).T</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    idx_valid <span class="op">=</span> []</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> b <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(gpdf)):</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>        mpath <span class="op">=</span> mplp.Path(<span class="bu">list</span>(gpdf[b][<span class="st">'geometry'</span>].to_crs(np.<span class="bu">int</span>(proj_cube)).boundary.explode(index_parts <span class="op">=</span> <span class="va">True</span>).iloc[<span class="dv">0</span>].coords))</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>        glacier_mask <span class="op">=</span> mpath.contains_points(points).reshape(Xs.shape)</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Grab the indices of the points inside the glacier</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>        idx_valid.append(np.array(np.where(glacier_mask<span class="op">==</span><span class="va">True</span>)))</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>    idx_valid <span class="op">=</span> np.hstack(idx_valid)</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the valid indices</span></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>    data_dict[url][<span class="st">'valid_idx'</span>] <span class="op">=</span> idx_valid</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the cube projection</span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>    data_dict[url][<span class="st">'proj_cube'</span>] <span class="op">=</span> proj_cube</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the coordinates of the valid Xs and Ys</span></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>    X_valid.append([Xs[idx_valid[<span class="dv">0</span>][i], idx_valid[<span class="dv">1</span>][i]] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(idx_valid[<span class="dv">0</span>]))])</span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>    Y_valid.append([Ys[idx_valid[<span class="dv">0</span>][i], idx_valid[<span class="dv">1</span>][i]] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(idx_valid[<span class="dv">0</span>]))])</span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X_tot, Y_tot, X_valid, Y_valid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For each datacube you selected, locate the on-glacier cells. Once it has been done, create an array gathering all the glacier cells you want to invert.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    data_dict, X_valid, Y_valid, X_tot, Y_tot <span class="op">=</span> create_data_dict(urls)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> url <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="bu">len</span>(urls))):</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        X_tot, Y_tot, X_valid, Y_valid <span class="op">=</span> get_extents(urls[url], gpdf_ls, X_tot, Y_tot, X_valid, Y_valid, data_dict)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create Eastings and Northings arrays based on the Eastings and Northings of the datacubes</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    X_arr <span class="op">=</span> np.unique(np.hstack(X_tot))</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    Y_arr <span class="op">=</span> np.unique(np.hstack(Y_tot))</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crop to the GOI (so we avoid over-filling our matrix with NaNs)</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    x_min <span class="op">=</span> np.where(np.<span class="bu">min</span>(np.hstack(X_valid)) <span class="op">==</span> X_arr)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    x_max <span class="op">=</span> np.where(np.<span class="bu">max</span>(np.hstack(X_valid)) <span class="op">==</span> X_arr)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    y_min <span class="op">=</span> np.where(np.<span class="bu">min</span>(np.hstack(Y_valid)) <span class="op">==</span> Y_arr)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    y_max <span class="op">=</span> np.where(np.<span class="bu">max</span>(np.hstack(Y_valid)) <span class="op">==</span> Y_arr)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># And now search the indices corresponding to the coordinates </span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>    x_matches <span class="op">=</span> np.hstack([[np.where(i <span class="op">==</span> X_arr[<span class="bu">min</span>(x_min<span class="op">-</span><span class="dv">1</span>, x_max<span class="op">+</span><span class="dv">1</span>):<span class="bu">max</span>(x_min<span class="op">-</span><span class="dv">1</span>, x_max<span class="op">+</span><span class="dv">1</span>)])[<span class="dv">0</span>][<span class="dv">0</span>] <span class="cf">for</span> i <span class="kw">in</span> row] <span class="cf">for</span> row <span class="kw">in</span> X_valid]).astype(<span class="bu">int</span>)</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    y_matches <span class="op">=</span> np.hstack([[np.where(i <span class="op">==</span> Y_arr[<span class="bu">min</span>(y_min<span class="op">-</span><span class="dv">1</span>, y_max<span class="op">+</span><span class="dv">1</span>):<span class="bu">max</span>(y_min<span class="op">-</span><span class="dv">1</span>, y_max<span class="op">+</span><span class="dv">1</span>)])[<span class="dv">0</span>][<span class="dv">0</span>] <span class="cf">for</span> i <span class="kw">in</span> row] <span class="cf">for</span> row <span class="kw">in</span> Y_valid]).astype(<span class="bu">int</span>)</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an array representing the glacier</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>    template <span class="op">=</span> np.zeros((<span class="bu">len</span>(Y_arr[<span class="bu">min</span>(y_min<span class="op">-</span><span class="dv">1</span>, y_max<span class="op">+</span><span class="dv">1</span>):<span class="bu">max</span>(y_min<span class="op">-</span><span class="dv">1</span>, y_max<span class="op">+</span><span class="dv">1</span>)]), <span class="bu">len</span>( X_arr[<span class="bu">min</span>(x_min<span class="op">-</span><span class="dv">1</span>, x_max<span class="op">+</span><span class="dv">1</span>):<span class="bu">max</span>(x_min<span class="op">-</span><span class="dv">1</span>, x_max<span class="op">+</span><span class="dv">1</span>)])))</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    template[y_matches, x_matches] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>0it [00:00, ?it/s]</code></pre>
</div>
</div>
<p>Plot the glacier shape to visualize which cells will be inverted/downloaded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    plt.pcolormesh(X_arr[x_min<span class="op">-</span><span class="dv">1</span>:x_max<span class="op">+</span><span class="dv">1</span>], Y_arr[y_min<span class="op">-</span><span class="dv">1</span>:y_max<span class="op">+</span><span class="dv">1</span>], template)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Design Matrix</strong></p>
<p>The following function creates a unique design matrix for each datacube. This design matrix will then be assembled in the inversion function. The design matrix shares a common base for each point in the same datacube. But because each point has a different temporal completness, we modify the base design matrix to fit the point’s data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> design_matrices(url, mission, lamb, derivative, day_interval, sdate, edate):</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If you passed 'mission' as an argument, it grabs the appropriate values</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mission:</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the indices of the mission</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>        filt1 <span class="op">=</span> np.where(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'satellite_img1'</span>][:] <span class="op">==</span> mission)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>        filt2 <span class="op">=</span> np.where(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'satellite_img2'</span>][:] <span class="op">==</span> mission)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>        inds_mission <span class="op">=</span> np.intersect1d(filt1[<span class="dv">0</span>],filt2[<span class="dv">0</span>])</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Grab only the indices corresponding to the missions</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        mid_dates <span class="op">=</span> np.datetime64(<span class="st">'1970-01-01'</span>) <span class="op">+</span> np.array(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'mid_date'</span>][:], dtype<span class="op">=</span><span class="st">'timedelta64[D]'</span>)[inds_mission]</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        im1 <span class="op">=</span> np.datetime64(<span class="st">'1970-01-01'</span>) <span class="op">+</span> np.array(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'acquisition_date_img1'</span>][:], dtype<span class="op">=</span><span class="st">'timedelta64[D]'</span>)[inds_mission]</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>        im2 <span class="op">=</span> np.datetime64(<span class="st">'1970-01-01'</span>) <span class="op">+</span> np.array(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'acquisition_date_img2'</span>][:], dtype<span class="op">=</span><span class="st">'timedelta64[D]'</span>)[inds_mission]</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If 'None' was passed as a mission argument, we grab all the available data.</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>        inds_mission <span class="op">=</span> <span class="va">None</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>        mid_dates <span class="op">=</span> np.datetime64(<span class="st">'1970-01-01'</span>) <span class="op">+</span> np.array(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'mid_date'</span>][:], dtype<span class="op">=</span><span class="st">'timedelta64[D]'</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>        im1 <span class="op">=</span> np.datetime64(<span class="st">'1970-01-01'</span>) <span class="op">+</span> np.array(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'acquisition_date_img1'</span>][:], dtype<span class="op">=</span><span class="st">'timedelta64[D]'</span>)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>        im2 <span class="op">=</span> np.datetime64(<span class="st">'1970-01-01'</span>) <span class="op">+</span> np.array(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'acquisition_date_img2'</span>][:], dtype<span class="op">=</span><span class="st">'timedelta64[D]'</span>)</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get some arrays</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>    index_sort <span class="op">=</span> np.argsort(np.datetime64(<span class="st">'1970-01-01'</span>) <span class="op">+</span> np.array(data_dict[urls[url]][<span class="st">'zarr_store'</span>][<span class="st">'mid_date'</span>][:], dtype<span class="op">=</span><span class="st">'timedelta64[D]'</span>))</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>    mid_dates <span class="op">=</span> mid_dates[index_sort]</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>    im1 <span class="op">=</span> im1[index_sort]</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    im2 <span class="op">=</span> im2[index_sort]</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If sdate is later than the first available date, we find its corresponding index</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>        sdate_ind <span class="op">=</span> np.where(mid_dates <span class="op">&gt;=</span> sdate)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>        sdate_ind <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If edate is sooner than the last available date, we find its corresponding index</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>        edate_ind <span class="op">=</span> np.where(mid_dates <span class="op">&gt;</span> edate)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>        edate_ind <span class="op">=</span> <span class="va">None</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a False/True mask where True if the date is in the desired range</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a>    mask_dates <span class="op">=</span> np.full(mid_dates.shape, <span class="va">False</span>)</span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a>    mask_dates[sdate_ind:edate_ind] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only the values within the desired range</span></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>    mid_dates <span class="op">=</span> mid_dates[mask_dates]</span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a>    im1 <span class="op">=</span> im1[mask_dates]</span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a>    im2 <span class="op">=</span> im2[mask_dates]</span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check which im is the smallest (first image, it changes depending on ITS_LIVE's version)</span></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> im2[<span class="dv">0</span>] <span class="op">&lt;</span> im1[<span class="dv">0</span>]:</span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a>        temp <span class="op">=</span> im1</span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a>        im1 <span class="op">=</span> im2</span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>        im2 <span class="op">=</span> temp</span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the date array with the new interval dates</span></span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>    dates_nonum <span class="op">=</span> np.arange(mid_dates[<span class="dv">0</span>], mid_dates[<span class="op">-</span><span class="dv">1</span>], timedelta(days<span class="op">=</span>day_interval)).astype(np.datetime64)</span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-57"><a href="#cb70-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to numerical</span></span>
<span id="cb70-58"><a href="#cb70-58" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> (dates_nonum <span class="op">-</span> np.datetime64(<span class="st">'1970-01-01T00:00:00Z'</span>))<span class="op">/</span>np.timedelta64(<span class="dv">1</span>, <span class="st">'s'</span>)</span>
<span id="cb70-59"><a href="#cb70-59" aria-hidden="true" tabindex="-1"></a>    dt_start <span class="op">=</span> (im1 <span class="op">-</span> np.datetime64(<span class="st">'1970-01-01T00:00:00Z'</span>))<span class="op">/</span>np.timedelta64(<span class="dv">1</span>, <span class="st">'s'</span>)</span>
<span id="cb70-60"><a href="#cb70-60" aria-hidden="true" tabindex="-1"></a>    dt_end <span class="op">=</span> (im2 <span class="op">-</span> np.datetime64(<span class="st">'1970-01-01T00:00:00Z'</span>))<span class="op">/</span>np.timedelta64(<span class="dv">1</span>, <span class="st">'s'</span>)</span>
<span id="cb70-61"><a href="#cb70-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-62"><a href="#cb70-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --------------- DESIGN MATRICES --------------- </span></span>
<span id="cb70-63"><a href="#cb70-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-64"><a href="#cb70-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize matrix</span></span>
<span id="cb70-65"><a href="#cb70-65" aria-hidden="true" tabindex="-1"></a>    A_m <span class="op">=</span> np.zeros((mid_dates.shape[<span class="dv">0</span>],dates.shape[<span class="dv">0</span>]))</span>
<span id="cb70-66"><a href="#cb70-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-67"><a href="#cb70-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We have to iterate through the satellite pairs that actually gave a measurement</span></span>
<span id="cb70-68"><a href="#cb70-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(mid_dates)):</span>
<span id="cb70-69"><a href="#cb70-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># current contents of your for loop</span></span>
<span id="cb70-70"><a href="#cb70-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-71"><a href="#cb70-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find the middate that is the closest to dt_start (supequal)</span></span>
<span id="cb70-72"><a href="#cb70-72" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> np.argmin(np.<span class="bu">abs</span>(dates<span class="op">-</span>dt_start[j]))</span>
<span id="cb70-73"><a href="#cb70-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-74"><a href="#cb70-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find the middate that is closest to dt_end (infequal)</span></span>
<span id="cb70-75"><a href="#cb70-75" aria-hidden="true" tabindex="-1"></a>        end <span class="op">=</span> np.argmin(dt_end[j] <span class="op">-</span> dates[dates <span class="op">&lt;=</span> dt_end[j]])</span>
<span id="cb70-76"><a href="#cb70-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-77"><a href="#cb70-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Divide 1 by the amount of middates between d_start and d_end </span></span>
<span id="cb70-78"><a href="#cb70-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> end <span class="op">==</span> A_m.shape[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span>: <span class="co"># If the mid_date is at the end of the array (acquisition im2 equals last mid_date)</span></span>
<span id="cb70-79"><a href="#cb70-79" aria-hidden="true" tabindex="-1"></a>            A_m[j, start:] <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>A_m.shape[<span class="dv">1</span>]<span class="op">-</span>start)</span>
<span id="cb70-80"><a href="#cb70-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>: <span class="co"># If the measurement is in A's bounds temporally (we can have a satellite pair with the 2nd pair being outside of our mid_dates)</span></span>
<span id="cb70-81"><a href="#cb70-81" aria-hidden="true" tabindex="-1"></a>            A_m[j, start:end<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>end<span class="op">-</span>start) <span class="co"># Attribute to each pixel in the timescale of the satellite pair, the 1/amount of pixel in the pairmid_dates.shape</span></span>
<span id="cb70-82"><a href="#cb70-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-83"><a href="#cb70-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-84"><a href="#cb70-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize regularization matrix</span></span>
<span id="cb70-85"><a href="#cb70-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> derivative <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb70-86"><a href="#cb70-86" aria-hidden="true" tabindex="-1"></a>        reg_mat_Inv <span class="op">=</span> np.zeros((A_m.shape[<span class="dv">1</span>] <span class="op">-</span><span class="dv">1</span>, A_m.shape[<span class="dv">1</span>]))</span>
<span id="cb70-87"><a href="#cb70-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-88"><a href="#cb70-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(A_m.shape[<span class="dv">1</span>] <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb70-89"><a href="#cb70-89" aria-hidden="true" tabindex="-1"></a>            reg_mat_Inv[j, j] <span class="op">=</span> <span class="op">-</span>lamb<span class="op">/</span>day_interval</span>
<span id="cb70-90"><a href="#cb70-90" aria-hidden="true" tabindex="-1"></a>            reg_mat_Inv[j, j<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> lamb<span class="op">/</span>day_interval</span>
<span id="cb70-91"><a href="#cb70-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-92"><a href="#cb70-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> derivative <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb70-93"><a href="#cb70-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize 2nd derivative regularization matrix</span></span>
<span id="cb70-94"><a href="#cb70-94" aria-hidden="true" tabindex="-1"></a>        reg_mat_Inv <span class="op">=</span> np.zeros((A_m.shape[<span class="dv">1</span>] <span class="op">-</span><span class="dv">1</span>, A_m.shape[<span class="dv">1</span>]))</span>
<span id="cb70-95"><a href="#cb70-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-96"><a href="#cb70-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(A_m.shape[<span class="dv">1</span>] <span class="op">-</span><span class="dv">2</span>):</span>
<span id="cb70-97"><a href="#cb70-97" aria-hidden="true" tabindex="-1"></a>            reg_mat_Inv[j, j] <span class="op">=</span> lamb<span class="op">/</span>(day_interval<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb70-98"><a href="#cb70-98" aria-hidden="true" tabindex="-1"></a>            reg_mat_Inv[j, j<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">2</span><span class="op">*</span>lamb<span class="op">/</span>(day_interval<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb70-99"><a href="#cb70-99" aria-hidden="true" tabindex="-1"></a>            reg_mat_Inv[j, j<span class="op">+</span><span class="dv">2</span>] <span class="op">=</span> lamb<span class="op">/</span>(day_interval<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb70-100"><a href="#cb70-100" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb70-101"><a href="#cb70-101" aria-hidden="true" tabindex="-1"></a>    data_dict[urls[url]][<span class="st">'A_m'</span>] <span class="op">=</span> A_m</span>
<span id="cb70-102"><a href="#cb70-102" aria-hidden="true" tabindex="-1"></a>    data_dict[urls[url]][<span class="st">'reg_mat_Inv'</span>] <span class="op">=</span> reg_mat_Inv</span>
<span id="cb70-103"><a href="#cb70-103" aria-hidden="true" tabindex="-1"></a>    data_dict[urls[url]][<span class="st">'mission'</span>] <span class="op">=</span> mission</span>
<span id="cb70-104"><a href="#cb70-104" aria-hidden="true" tabindex="-1"></a>    data_dict[urls[url]][<span class="st">'index_sort'</span>] <span class="op">=</span> index_sort</span>
<span id="cb70-105"><a href="#cb70-105" aria-hidden="true" tabindex="-1"></a>    data_dict[urls[url]][<span class="st">'inds_mission'</span>] <span class="op">=</span> inds_mission</span>
<span id="cb70-106"><a href="#cb70-106" aria-hidden="true" tabindex="-1"></a>    data_dict[urls[url]][<span class="st">'dates'</span>] <span class="op">=</span> dates_nonum</span>
<span id="cb70-107"><a href="#cb70-107" aria-hidden="true" tabindex="-1"></a>    data_dict[urls[url]][<span class="st">'dates_noinv'</span>] <span class="op">=</span> mid_dates</span>
<span id="cb70-108"><a href="#cb70-108" aria-hidden="true" tabindex="-1"></a>    data_dict[urls[url]][<span class="st">'mask_dates'</span>]<span class="op">=</span> mask_dates</span>
<span id="cb70-109"><a href="#cb70-109" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb70-110"><a href="#cb70-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create one design matrix per datacube</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> tqdm(<span class="bu">range</span>(<span class="bu">len</span>(urls))):</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>        design_matrices(i, mission, lamb, derivative, day_interval)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>0it [00:00, ?it/s]</code></pre>
</div>
</div>
<p><strong>Point Inversion</strong></p>
<p>This function inputs a timeseries for a point and inverts it based on the design matrix build for the datacube the point belongs to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Inv_reg(vObs, data, fillvalue):</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grab observed velocities</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    vObs <span class="op">=</span> vObs[data[<span class="st">'index_sort'</span>]]</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    vObs <span class="op">=</span> vObs[data[<span class="st">'mask_dates'</span>]]</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out the missions we don't want</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mission:</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        vObs <span class="op">=</span> vObs[data[<span class="st">'inds_mission'</span>]]  </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mask the NaNs so we don't compute the inversion for empty rows</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.logical_not(np.equal(vObs, fillvalue))</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a masked velocity vector</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    vObs_masked <span class="op">=</span> vObs[mask]</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append regularization terms to dObs</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>    vObs_masked<span class="op">=</span> np.hstack((vObs_masked, np.zeros((data[<span class="st">'reg_mat_Inv'</span>].shape[<span class="dv">0</span>]))))</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assemble the design matrix</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    A_des <span class="op">=</span> np.vstack((data[<span class="st">'A_m'</span>][mask], data[<span class="st">'reg_mat_Inv'</span>]))</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Invert the velocities</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>    vInv <span class="op">=</span> np.linalg.solve(A_des.T<span class="op">@</span>A_des,A_des.T<span class="op">@</span>vObs_masked)</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#vInv = scipy.linalg.solve(A_des.T@A_des,A_des.T@vObs_masked, lower = False, check_finite=False, assume_a='gen')</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vInv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Gather the dates at which we have an observation, spanning all the selected datacubes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the total amount of temporal steps</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>ind_tot <span class="op">=</span> []</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> urls:</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    ind_tot.append(data_dict[i][<span class="st">'dates'</span>])</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>ind_tot <span class="op">=</span> np.unique(np.hstack(ind_tot))</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> urls:</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    data_dict[i][<span class="st">'ind_tot'</span>] <span class="op">=</span> np.array([np.where(c <span class="op">==</span> ind_tot)[<span class="dv">0</span>][<span class="dv">0</span>] <span class="cf">for</span> c <span class="kw">in</span> data_dict[urls[<span class="dv">0</span>]][<span class="st">'dates'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Inversion Calculation</strong></p>
<p>The following cell loops through all the on-ice cells in the datacubes. It runs the inversion and outputs a timeseries linearized in time (based on your input at the beginning of the notebook). It generates a .txt file that shows how many cells have been inverted. This is a check in case you get disconnected from your notebook but it still runs in the background. It also saves the output every 10000 iterations so if the script crashes, you don’t have to start from scratch.</p>
<p>Once the inversion is complete, it saves the output one last time as a netcdf file containing: vx, vy, time, x, y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> GPU:</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> torch</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    device <span class="op">=</span> torch.device(<span class="st">"cuda:0"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co">    # Migrate to torch &amp; GPU</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co">    for c in range(len(urls)):</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co">        data_dict[urls[c]]['A_m'] = torch.from_numpy(data_dict[urls[c]]['A_m']).to(device)</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co">        data_dict[urls[c]]['reg_mat_Inv'] = torch.from_numpy(data_dict[urls[c]]['reg_mat_Inv']).to(device)</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> Inv_reg_torch(vObs, data, fillvalue, device):</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Grab observed velocities</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>        vObs <span class="op">=</span> vObs[data[<span class="st">'index_sort'</span>]]</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>        vObs <span class="op">=</span> vObs[data[<span class="st">'mask_dates'</span>]]</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter out the missions we don't want</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mission:</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>            vObs <span class="op">=</span> vObs[data[<span class="st">'inds_mission'</span>]]  </span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Mask the NaNs so we don't compute the inversion for empty rows</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> np.logical_not(np.equal(vObs, fillvalue))</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a masked velocity vector</span></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>        vObs_masked <span class="op">=</span> torch.from_numpy(vObs[mask])</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append regularization terms to dObs</span></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>        vObs_masked<span class="op">=</span> torch.hstack((vObs_masked, torch.zeros((data[<span class="st">'reg_mat_Inv'</span>].shape[<span class="dv">0</span>])))).to(device)</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assemble the design matrix</span></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>        A_des <span class="op">=</span> torch.vstack((data[<span class="st">'A_m'</span>][mask], data[<span class="st">'reg_mat_Inv'</span>]))</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Invert the velocities</span></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>        vInv <span class="op">=</span> torch.linalg.solve(A_des.T<span class="op">@</span>A_des,A_des.T<span class="op">@</span>vObs_masked.double())</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> vInv</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>    vxInv <span class="op">=</span> torch.zeros((<span class="bu">len</span>(ind_tot), template.shape[<span class="dv">0</span>], template.shape[<span class="dv">1</span>])).double().to(device)</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>    vyInv <span class="op">=</span> torch.zeros((vxInv.shape)).double().to(device)</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the total number of iterations</span></span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>    total_iterations <span class="op">=</span> <span class="bu">len</span>(y_matches)</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a tqdm object with dynamic_ncols=False to suppress intermediate updates</span></span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a tqdm object with a larger mininterval to suppress intermediate updates</span></span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>    progress_bar <span class="op">=</span> tqdm(total<span class="op">=</span>total_iterations, dynamic_ncols<span class="op">=</span><span class="va">False</span>, mininterval<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(urls)):</span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> data_dict[urls[c]][<span class="st">'valid_idx'</span>]</span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a>        fillvx <span class="op">=</span> data_dict[urls[c]][<span class="st">'zarr_store'</span>][<span class="st">'vx'</span>][:, valid_idx[<span class="dv">0</span>][<span class="dv">0</span>], valid_idx[<span class="dv">1</span>][<span class="dv">0</span>]].<span class="bu">min</span>() <span class="co">#data_dict[urls[c]]['zarr_store']['vx'].fill_value   fill_value is wrong in the new ITS_LIVE version</span></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a>        fillvy <span class="op">=</span> data_dict[urls[c]][<span class="st">'zarr_store'</span>][<span class="st">'vx'</span>][:, valid_idx[<span class="dv">0</span>][<span class="dv">0</span>], valid_idx[<span class="dv">1</span>][<span class="dv">0</span>]].<span class="bu">min</span>() <span class="co">#data_dict[urls[c]]['zarr_store']['vy'].fill_value</span></span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> V <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(valid_idx[<span class="dv">0</span>])):</span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a>            vxObs <span class="op">=</span> data_dict[urls[c]][<span class="st">'zarr_store'</span>][<span class="st">'vx'</span>][:, valid_idx[<span class="dv">0</span>][V], valid_idx[<span class="dv">1</span>][V]]</span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a>            vyObs <span class="op">=</span> data_dict[urls[c]][<span class="st">'zarr_store'</span>][<span class="st">'vy'</span>][:, valid_idx[<span class="dv">0</span>][V], valid_idx[<span class="dv">1</span>][V]]</span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a>            vxInv[data_dict[urls[c]][<span class="st">'ind_tot'</span>], y_matches[i], x_matches[i]] <span class="op">=</span> Inv_reg_torch(vxObs, data_dict[urls[c]], fillvx, device)</span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a>            vyInv[data_dict[urls[c]][<span class="st">'ind_tot'</span>], y_matches[i], x_matches[i]] <span class="op">=</span> Inv_reg_torch(vyObs, data_dict[urls[c]], fillvy, device)</span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a>            progress_bar.update(<span class="dv">1</span>)  <span class="co"># Update the progress bar</span></span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">%</span><span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb75-67"><a href="#cb75-67" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"Counter.txt"</span>, <span class="st">"w"</span>) <span class="im">as</span> text_file:</span>
<span id="cb75-68"><a href="#cb75-68" aria-hidden="true" tabindex="-1"></a>                    text_file.write(<span class="ss">f"Counter: </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-69"><a href="#cb75-69" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-70"><a href="#cb75-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">%</span><span class="dv">5000</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb75-71"><a href="#cb75-71" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb75-72"><a href="#cb75-72" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Saved at </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-73"><a href="#cb75-73" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Get the names of all the glaciers in the datacube </span></span>
<span id="cb75-74"><a href="#cb75-74" aria-hidden="true" tabindex="-1"></a>                <span class="co">#glac_names = np.hstack(np.array([glacier.id.values[0] for glacier in gdf_list]))</span></span>
<span id="cb75-75"><a href="#cb75-75" aria-hidden="true" tabindex="-1"></a>                <span class="co">#glac_names = '-'.join(glac_names)</span></span>
<span id="cb75-76"><a href="#cb75-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-77"><a href="#cb75-77" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Gather the projection of the cube</span></span>
<span id="cb75-78"><a href="#cb75-78" aria-hidden="true" tabindex="-1"></a>                <span class="co">#glac_proj = str(np.unique(np.hstack([data_dict[urls[i]]['proj_cube'] for i in range(len(urls))]))[0])</span></span>
<span id="cb75-79"><a href="#cb75-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-80"><a href="#cb75-80" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Create a new dataset with vx and vy, using attributes from 'ds'</span></span>
<span id="cb75-81"><a href="#cb75-81" aria-hidden="true" tabindex="-1"></a>                new_ds <span class="op">=</span> xr.Dataset(</span>
<span id="cb75-82"><a href="#cb75-82" aria-hidden="true" tabindex="-1"></a>                    {</span>
<span id="cb75-83"><a href="#cb75-83" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"vx"</span>: ([<span class="st">"time"</span>, <span class="st">"y"</span>, <span class="st">"x"</span>], vxInv.cpu().numpy()),</span>
<span id="cb75-84"><a href="#cb75-84" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"vy"</span>: ([<span class="st">"time"</span>, <span class="st">"y"</span>, <span class="st">"x"</span>], vyInv.cpu().numpy()),</span>
<span id="cb75-85"><a href="#cb75-85" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb75-86"><a href="#cb75-86" aria-hidden="true" tabindex="-1"></a>                    coords<span class="op">=</span>{</span>
<span id="cb75-87"><a href="#cb75-87" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"time"</span>: ind_tot,</span>
<span id="cb75-88"><a href="#cb75-88" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"x"</span>: X_arr[x_min<span class="op">-</span><span class="dv">1</span>:x_max<span class="op">+</span><span class="dv">1</span>],</span>
<span id="cb75-89"><a href="#cb75-89" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"y"</span>: Y_arr[y_min<span class="op">-</span><span class="dv">1</span>:y_max<span class="op">+</span><span class="dv">1</span>],</span>
<span id="cb75-90"><a href="#cb75-90" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb75-91"><a href="#cb75-91" aria-hidden="true" tabindex="-1"></a>                    attrs<span class="op">=</span>data_dict[urls[<span class="dv">0</span>]][<span class="st">'zarr_store'</span>].attrs,</span>
<span id="cb75-92"><a href="#cb75-92" aria-hidden="true" tabindex="-1"></a>                ).chunk({<span class="st">'time'</span>: <span class="dv">1</span>, <span class="st">'x'</span>: <span class="dv">100</span>, <span class="st">'y'</span>: <span class="dv">100</span>})</span>
<span id="cb75-93"><a href="#cb75-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-94"><a href="#cb75-94" aria-hidden="true" tabindex="-1"></a>                <span class="im">from</span> dask.diagnostics <span class="im">import</span> ProgressBar</span>
<span id="cb75-95"><a href="#cb75-95" aria-hidden="true" tabindex="-1"></a>                write_job <span class="op">=</span> new_ds.to_netcdf(<span class="ss">f'VelInv.nc'</span>, compute<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb75-96"><a href="#cb75-96" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> ProgressBar():</span>
<span id="cb75-97"><a href="#cb75-97" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Writing to </span><span class="sc">{</span><span class="st">'VelInv.nc'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-98"><a href="#cb75-98" aria-hidden="true" tabindex="-1"></a>                    write_job.compute()</span>
<span id="cb75-99"><a href="#cb75-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-100"><a href="#cb75-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Close the progress bar</span></span>
<span id="cb75-101"><a href="#cb75-101" aria-hidden="true" tabindex="-1"></a>    progress_bar.close()</span>
<span id="cb75-102"><a href="#cb75-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-103"><a href="#cb75-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the dataset</span></span>
<span id="cb75-104"><a href="#cb75-104" aria-hidden="true" tabindex="-1"></a>    new_ds <span class="op">=</span> xr.Dataset(</span>
<span id="cb75-105"><a href="#cb75-105" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb75-106"><a href="#cb75-106" aria-hidden="true" tabindex="-1"></a>            <span class="st">"vx"</span>: ([<span class="st">"time"</span>, <span class="st">"y"</span>, <span class="st">"x"</span>], vxInv.cpu().numpy()),</span>
<span id="cb75-107"><a href="#cb75-107" aria-hidden="true" tabindex="-1"></a>            <span class="st">"vy"</span>: ([<span class="st">"time"</span>, <span class="st">"y"</span>, <span class="st">"x"</span>], vyInv.cpu().numpy()),</span>
<span id="cb75-108"><a href="#cb75-108" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb75-109"><a href="#cb75-109" aria-hidden="true" tabindex="-1"></a>        coords<span class="op">=</span>{</span>
<span id="cb75-110"><a href="#cb75-110" aria-hidden="true" tabindex="-1"></a>            <span class="st">"time"</span>: ind_tot,</span>
<span id="cb75-111"><a href="#cb75-111" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x"</span>: X_arr[x_min<span class="op">-</span><span class="dv">1</span>:x_max<span class="op">+</span><span class="dv">1</span>],</span>
<span id="cb75-112"><a href="#cb75-112" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y"</span>: Y_arr[y_min<span class="op">-</span><span class="dv">1</span>:y_max<span class="op">+</span><span class="dv">1</span>],</span>
<span id="cb75-113"><a href="#cb75-113" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb75-114"><a href="#cb75-114" aria-hidden="true" tabindex="-1"></a>        attrs<span class="op">=</span>data_dict[urls[<span class="dv">0</span>]][<span class="st">'zarr_store'</span>].attrs,</span>
<span id="cb75-115"><a href="#cb75-115" aria-hidden="true" tabindex="-1"></a>    ).chunk({<span class="st">'time'</span>: <span class="dv">1</span>, <span class="st">'x'</span>: <span class="dv">100</span>, <span class="st">'y'</span>: <span class="dv">100</span>})</span>
<span id="cb75-116"><a href="#cb75-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-117"><a href="#cb75-117" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> dask.diagnostics <span class="im">import</span> ProgressBar</span>
<span id="cb75-118"><a href="#cb75-118" aria-hidden="true" tabindex="-1"></a>    write_job <span class="op">=</span> new_ds.to_netcdf(<span class="ss">f'VelInv.nc'</span>, compute<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb75-119"><a href="#cb75-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> ProgressBar():</span>
<span id="cb75-120"><a href="#cb75-120" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Writing to </span><span class="sc">{</span><span class="st">'VelInv.nc'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-121"><a href="#cb75-121" aria-hidden="true" tabindex="-1"></a>        write_job.compute()</span>
<span id="cb75-122"><a href="#cb75-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-123"><a href="#cb75-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-124"><a href="#cb75-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-125"><a href="#cb75-125" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb75-126"><a href="#cb75-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-127"><a href="#cb75-127" aria-hidden="true" tabindex="-1"></a>    vxInv <span class="op">=</span> np.zeros((<span class="bu">len</span>(ind_tot), template.shape[<span class="dv">0</span>], template.shape[<span class="dv">1</span>]))</span>
<span id="cb75-128"><a href="#cb75-128" aria-hidden="true" tabindex="-1"></a>    vyInv <span class="op">=</span> np.zeros((vxInv.shape))</span>
<span id="cb75-129"><a href="#cb75-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-130"><a href="#cb75-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the total number of iterations</span></span>
<span id="cb75-131"><a href="#cb75-131" aria-hidden="true" tabindex="-1"></a>    total_iterations <span class="op">=</span> <span class="bu">len</span>(y_matches)</span>
<span id="cb75-132"><a href="#cb75-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-133"><a href="#cb75-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a tqdm object with dynamic_ncols=False to suppress intermediate updates</span></span>
<span id="cb75-134"><a href="#cb75-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a tqdm object with a larger mininterval to suppress intermediate updates</span></span>
<span id="cb75-135"><a href="#cb75-135" aria-hidden="true" tabindex="-1"></a>    progress_bar <span class="op">=</span> tqdm(total<span class="op">=</span>total_iterations, dynamic_ncols<span class="op">=</span><span class="va">False</span>, mininterval<span class="op">=</span><span class="fl">1.0</span>)</span>
<span id="cb75-136"><a href="#cb75-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-137"><a href="#cb75-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-138"><a href="#cb75-138" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-139"><a href="#cb75-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(urls)):</span>
<span id="cb75-140"><a href="#cb75-140" aria-hidden="true" tabindex="-1"></a>        valid_idx <span class="op">=</span> data_dict[urls[c]][<span class="st">'valid_idx'</span>]</span>
<span id="cb75-141"><a href="#cb75-141" aria-hidden="true" tabindex="-1"></a>        fillvx <span class="op">=</span> data_dict[urls[c]][<span class="st">'zarr_store'</span>][<span class="st">'vx'</span>][:, valid_idx[<span class="dv">0</span>][<span class="dv">0</span>], valid_idx[<span class="dv">1</span>][<span class="dv">0</span>]].<span class="bu">min</span>() <span class="co">#data_dict[urls[c]]['zarr_store']['vx'].fill_value   fill_value is wrong in the new ITS_LIVE version</span></span>
<span id="cb75-142"><a href="#cb75-142" aria-hidden="true" tabindex="-1"></a>        fillvy <span class="op">=</span> data_dict[urls[c]][<span class="st">'zarr_store'</span>][<span class="st">'vx'</span>][:, valid_idx[<span class="dv">0</span>][<span class="dv">0</span>], valid_idx[<span class="dv">1</span>][<span class="dv">0</span>]].<span class="bu">min</span>() <span class="co">#data_dict[urls[c]]['zarr_store']['vy'].fill_value</span></span>
<span id="cb75-143"><a href="#cb75-143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-144"><a href="#cb75-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> V <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(valid_idx[<span class="dv">0</span>])):</span>
<span id="cb75-145"><a href="#cb75-145" aria-hidden="true" tabindex="-1"></a>            vxObs <span class="op">=</span> data_dict[urls[c]][<span class="st">'zarr_store'</span>][<span class="st">'vx'</span>][:, valid_idx[<span class="dv">0</span>][V], valid_idx[<span class="dv">1</span>][V]]</span>
<span id="cb75-146"><a href="#cb75-146" aria-hidden="true" tabindex="-1"></a>            vyObs <span class="op">=</span> data_dict[urls[c]][<span class="st">'zarr_store'</span>][<span class="st">'vy'</span>][:, valid_idx[<span class="dv">0</span>][V], valid_idx[<span class="dv">1</span>][V]]</span>
<span id="cb75-147"><a href="#cb75-147" aria-hidden="true" tabindex="-1"></a>            vxInv[data_dict[urls[c]][<span class="st">'ind_tot'</span>], y_matches[i], x_matches[i]] <span class="op">=</span> Inv_reg(vxObs, data_dict[urls[c]], fillvx)</span>
<span id="cb75-148"><a href="#cb75-148" aria-hidden="true" tabindex="-1"></a>            vyInv[data_dict[urls[c]][<span class="st">'ind_tot'</span>], y_matches[i], x_matches[i]] <span class="op">=</span> Inv_reg(vyObs, data_dict[urls[c]], fillvy)</span>
<span id="cb75-149"><a href="#cb75-149" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-150"><a href="#cb75-150" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb75-151"><a href="#cb75-151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">%</span><span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb75-152"><a href="#cb75-152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"Counter.txt"</span>, <span class="st">"w"</span>) <span class="im">as</span> text_file:</span>
<span id="cb75-153"><a href="#cb75-153" aria-hidden="true" tabindex="-1"></a>                    text_file.write(<span class="ss">f"Counter: </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-154"><a href="#cb75-154" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb75-155"><a href="#cb75-155" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">%</span><span class="dv">10000</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb75-156"><a href="#cb75-156" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb75-157"><a href="#cb75-157" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Saved at </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-158"><a href="#cb75-158" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Get the names of all the glaciers in the datacube </span></span>
<span id="cb75-159"><a href="#cb75-159" aria-hidden="true" tabindex="-1"></a>                <span class="co">#glac_names = np.hstack(np.array([glacier.id.values[0] for glacier in gdf_list]))</span></span>
<span id="cb75-160"><a href="#cb75-160" aria-hidden="true" tabindex="-1"></a>                <span class="co">#glac_names = '-'.join(glac_names)</span></span>
<span id="cb75-161"><a href="#cb75-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-162"><a href="#cb75-162" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Gather the projection of the cube</span></span>
<span id="cb75-163"><a href="#cb75-163" aria-hidden="true" tabindex="-1"></a>                <span class="co">#glac_proj = str(np.unique(np.hstack([data_dict[urls[i]]['proj_cube'] for i in range(len(urls))]))[0])</span></span>
<span id="cb75-164"><a href="#cb75-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-165"><a href="#cb75-165" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Create a new dataset with vx and vy, using attributes from 'ds'</span></span>
<span id="cb75-166"><a href="#cb75-166" aria-hidden="true" tabindex="-1"></a>                new_ds <span class="op">=</span> xr.Dataset(</span>
<span id="cb75-167"><a href="#cb75-167" aria-hidden="true" tabindex="-1"></a>                    {</span>
<span id="cb75-168"><a href="#cb75-168" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"vx"</span>: ([<span class="st">"time"</span>, <span class="st">"y"</span>, <span class="st">"x"</span>], vxInv),</span>
<span id="cb75-169"><a href="#cb75-169" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"vy"</span>: ([<span class="st">"time"</span>, <span class="st">"y"</span>, <span class="st">"x"</span>], vyInv),</span>
<span id="cb75-170"><a href="#cb75-170" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb75-171"><a href="#cb75-171" aria-hidden="true" tabindex="-1"></a>                    coords<span class="op">=</span>{</span>
<span id="cb75-172"><a href="#cb75-172" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"time"</span>: ind_tot,</span>
<span id="cb75-173"><a href="#cb75-173" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"x"</span>: X_arr[x_min<span class="op">-</span><span class="dv">1</span>:x_max<span class="op">+</span><span class="dv">1</span>],</span>
<span id="cb75-174"><a href="#cb75-174" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"y"</span>: Y_arr[y_min<span class="op">-</span><span class="dv">1</span>:y_max<span class="op">+</span><span class="dv">1</span>],</span>
<span id="cb75-175"><a href="#cb75-175" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb75-176"><a href="#cb75-176" aria-hidden="true" tabindex="-1"></a>                    attrs<span class="op">=</span>data_dict[urls[<span class="dv">0</span>]][<span class="st">'zarr_store'</span>].attrs,</span>
<span id="cb75-177"><a href="#cb75-177" aria-hidden="true" tabindex="-1"></a>                ).chunk({<span class="st">'time'</span>: <span class="dv">1</span>, <span class="st">'x'</span>: <span class="dv">100</span>, <span class="st">'y'</span>: <span class="dv">100</span>})</span>
<span id="cb75-178"><a href="#cb75-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-179"><a href="#cb75-179" aria-hidden="true" tabindex="-1"></a>                <span class="im">from</span> dask.diagnostics <span class="im">import</span> ProgressBar</span>
<span id="cb75-180"><a href="#cb75-180" aria-hidden="true" tabindex="-1"></a>                write_job <span class="op">=</span> new_ds.to_netcdf(<span class="ss">f'Malaspina.nc'</span>, compute<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb75-181"><a href="#cb75-181" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> ProgressBar():</span>
<span id="cb75-182"><a href="#cb75-182" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Writing to </span><span class="sc">{</span><span class="st">'Malaspina.nc'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-183"><a href="#cb75-183" aria-hidden="true" tabindex="-1"></a>                    write_job.compute()</span>
<span id="cb75-184"><a href="#cb75-184" aria-hidden="true" tabindex="-1"></a>            progress_bar.update(<span class="dv">1</span>)  <span class="co"># Update the progress bar</span></span>
<span id="cb75-185"><a href="#cb75-185" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-186"><a href="#cb75-186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Close the progress bar</span></span>
<span id="cb75-187"><a href="#cb75-187" aria-hidden="true" tabindex="-1"></a>    progress_bar.close()</span>
<span id="cb75-188"><a href="#cb75-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-189"><a href="#cb75-189" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the dataset</span></span>
<span id="cb75-190"><a href="#cb75-190" aria-hidden="true" tabindex="-1"></a>    new_ds <span class="op">=</span> xr.Dataset(</span>
<span id="cb75-191"><a href="#cb75-191" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb75-192"><a href="#cb75-192" aria-hidden="true" tabindex="-1"></a>            <span class="st">"vx"</span>: ([<span class="st">"time"</span>, <span class="st">"y"</span>, <span class="st">"x"</span>], vxInv),</span>
<span id="cb75-193"><a href="#cb75-193" aria-hidden="true" tabindex="-1"></a>            <span class="st">"vy"</span>: ([<span class="st">"time"</span>, <span class="st">"y"</span>, <span class="st">"x"</span>], vyInv),</span>
<span id="cb75-194"><a href="#cb75-194" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb75-195"><a href="#cb75-195" aria-hidden="true" tabindex="-1"></a>        coords<span class="op">=</span>{</span>
<span id="cb75-196"><a href="#cb75-196" aria-hidden="true" tabindex="-1"></a>            <span class="st">"time"</span>: ind_tot,</span>
<span id="cb75-197"><a href="#cb75-197" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x"</span>: X_arr[x_min<span class="op">-</span><span class="dv">1</span>:x_max<span class="op">+</span><span class="dv">1</span>],</span>
<span id="cb75-198"><a href="#cb75-198" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y"</span>: Y_arr[y_min<span class="op">-</span><span class="dv">1</span>:y_max<span class="op">+</span><span class="dv">1</span>],</span>
<span id="cb75-199"><a href="#cb75-199" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb75-200"><a href="#cb75-200" aria-hidden="true" tabindex="-1"></a>        attrs<span class="op">=</span>data_dict[urls[<span class="dv">0</span>]][<span class="st">'zarr_store'</span>].attrs,</span>
<span id="cb75-201"><a href="#cb75-201" aria-hidden="true" tabindex="-1"></a>    ).chunk({<span class="st">'time'</span>: <span class="dv">1</span>, <span class="st">'x'</span>: <span class="dv">100</span>, <span class="st">'y'</span>: <span class="dv">100</span>})</span>
<span id="cb75-202"><a href="#cb75-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-203"><a href="#cb75-203" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> dask.diagnostics <span class="im">import</span> ProgressBar</span>
<span id="cb75-204"><a href="#cb75-204" aria-hidden="true" tabindex="-1"></a>    write_job <span class="op">=</span> new_ds.to_netcdf(<span class="ss">f'Malaspina.nc'</span>, compute<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb75-205"><a href="#cb75-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> ProgressBar():</span>
<span id="cb75-206"><a href="#cb75-206" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Writing to </span><span class="sc">{</span><span class="st">'Malaspina.nc'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-207"><a href="#cb75-207" aria-hidden="true" tabindex="-1"></a>        write_job.compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>